<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title> Infragistics jQuery Data Source - filtering QUnit tests </title> 
	<script type="text/javascript" src="../../../../bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="../../../../bower_components/jquery-tmpl/jquery.tmpl.js"></script>

	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.datasource.js"></script>
	
	<link type="text/css" href="../../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
	<script type="text/javascript" src="../../../../bower_components/qunit/qunit/qunit.js"></script>
	
	<style type="text/css">
		body {
			font-family: Verdana;
			font-size: 11pt;
		}
		
		body table {
			border-width: 1px;
			border-color: green;
			border-style: solid;
			background-color: lightGrey;
		}
		
		body table td {
			border: 1px green solid;
		}
	</style>
	
	<script id="template1" type="text/x-jquery-tmpl">
		${firstName} <strong> ${lastName} </strong> <br/>
	</script>
	
	<script id="tableTemplate" type="text/x-jquery-tmpl">
		<tr> <td> ${col1} </td> <td> ${col2} </td> <td> ${col3} </td>  <td> ${col4} </td> <td> ${col5} </td>  <td> ${col6} </td> </tr>
	</script>
	
	<script type="text/javascript"> 

		var tableDs = null;
		var jsonDs = null;
		var mapperDs = null;
		var treeDs = null;
		
		var cond = null; // filtering condition
		
		var date, before1, before2, before3, before4, before5, after1, after2, after3, after4, after5;
		
		var dataObject = {
			firstName: "John",
			lastName: "Resig",
			url: "http://ejohn.org/",
			cities: [
				"Boston, MA",
				"San Francisco, CA"
			]
		}
		
		var arrayOfDataObjects = [ 
			dataObject
			, 
			{
				firstName: "Dave",
				lastName: "Reed",
				url: "http://dave.org/",
				cities: [
					"Seattle, WA",
					"Los Angeles, CA",
					"New York, NY"
				]
			},
			{
				firstName: "Boris",
				lastName: "Moore",
				url: "http://boris.org/",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			},
			{
				firstName: "Angel",
				lastName: "Todorov",
				url: "http://www.infragistics.com",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			},
			{
				firstName: "Murtaza",
				lastName: "Abdeali",
				url: "http://www.infragistics.com",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			},
			{
				firstName: "Alex",
				lastName: "Kartavov",
				url: "http://www.infragistics.com",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			},
			{
				firstName: "Lubo",
				lastName: "Toshev",
				url: "http://www.infragistics.com",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			},
			{
				firstName: "Boris",
				lastName: "Moore",
				url: "http://boris.org/",
				cities: [
					"Redmond, WA",
					"Seattle, WA",
					"New York, NY"
				]
			}
		];

		var northwindProductsJSON = [
			   { "ID": 0, "Name": "Bread", "Description": "Whole grain bread", "ReleaseDate": "\/Date(694224000000)\/", "DiscontinuedDate": null, "Rating": 4, "Price": "2.5", "Category": { "ID": 0, "Name": "Food" } },
			   { "ID": 1, "Name": "Milk", "Description": "Low fat milk", "ReleaseDate": "\/Date(812505600000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "3.5", "Category": { "ID": 1, "Name": "Beverages" } },
			   { "ID": 2, "Name": "Vint Soda", "Description": "Americana Variety - Mix of 6 flavors", "ReleaseDate": "\/Date(970358400000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "20.9", "Category": { "ID": 1, "Name": "Beverages" } },
			   { "ID": 3, "Name": "Havina Cola", "Description": "The Original Key Lime Cola", "ReleaseDate": "\/Date(1128124800000)\/", "DiscontinuedDate": "\/Date(1159660800000)\/", "Rating": 3, "Price": "19.9", "Category": { "ID": 1, "Name": "Beverages" } },
			   { "ID": 4, "Name": "Fruit Punch", "Description": "Mango flavor, 8.3 Ounce Cans (Pack of 24)", "ReleaseDate": "\/Date(1041724800000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "22.99", "Category": { "ID": 1, "Name": "Beverages" } },
			   { "ID": 5, "Name": "Cranberry Juice", "Description": "16-Ounce Plastic Bottles (Pack of 12)", "ReleaseDate": "\/Date(1154649600000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "22.8", "Category": { "ID": 1, "Name": "Beverages" }, },
			   { "ID": 6, "Name": "Pink Lemonade", "Description": "36 Ounce Cans (Pack of 3)", "ReleaseDate": "\/Date(1162684800000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "18.8", "Category": { "ID": 1, "Name": "Beverages" }, },
			   { "ID": 7, "Name": "DVD Player", "Description": "1080P Upconversion DVD Player", "ReleaseDate": "\/Date(1163548800000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "35.88", "Category": { "ID": 2, "Name": "Electronics" } },
			   { "ID": 8, "Name": "LCD HDTV", "Description": "42 inch 1080p LCD with Built-in Blu-ray Disc Player", "ReleaseDate": "\/Date(1210204800000)\/", "DiscontinuedDate": null, "Rating": 3, "Price": "1088.8", "Category": { "ID": 2, "Name": "Electronics" } }
		];

		var treeFlatData = [
            { "employeeId": 0, "supervisorId": -1, "firstName": "Andrew", "lastName": "Fuller", "Category": { "ID": 0, "Name": "Name" } },
            { "employeeId": 1, "supervisorId": -1, "firstName": "Jonathan", "lastName": "Smith", "Category": { "ID": 1, "Name": "Name1" } },
            { "employeeId": 2, "supervisorId": -1, "firstName": "Nancy", "lastName": "Davolio", "Category": { "ID": 2, "Name": "Name2" } },
            { "employeeId": 3, "supervisorId": -1, "firstName": "Steven", "lastName": "Buchanan", "Category": { "ID": 0, "Name": "Name" } },

            // Andrew Fuller's direct reports
            { "employeeId": 4, "supervisorId": 0, "firstName": "Janet", "lastName": "Leverling", "Category": { "ID": 1, "Name": "Name1" } },
            { "employeeId": 5, "supervisorId": 0, "firstName": "Laura", "lastName": "Callahan", "Category": { "ID": 1, "Name": "Name1" } },
            { "employeeId": 6, "supervisorId": 0, "firstName": "Margaret", "lastName": "Peacock", "Category": { "ID": 0, "Name": "Name" } },
            { "employeeId": 7, "supervisorId": 0, "firstName": "Michael", "lastName": "Suyama", "Category": { "ID": 2, "Name": "Name2" } },

            // Janet Leverling's direct reports
            { "employeeId": 8, "supervisorId": 4, "firstName": "Anne", "lastName": "Dodsworth", "Category": { "ID": 2, "Name": "Name2" } },
            { "employeeId": 9, "supervisorId": 4, "firstName": "Danielle", "lastName": "Davis", "Category": { "ID": 2, "Name": "Name2" } },
            { "employeeId": 10, "supervisorId": 4, "firstName": "Robert", "lastName": "King", "Category": { "ID": 1, "Name": "Name1" } },

            // Nancy Davolio's direct reports
            { "employeeId": 11, "supervisorId": 2, "firstName": "Peter", "lastName": "Lewis", "Category": { "ID": 1, "Name": "Name1" } },
            { "employeeId": 12, "supervisorId": 2, "firstName": "Ryder", "lastName": "Zenaida", "Category": { "ID": 0, "Name": "Name" } },
            { "employeeId": 13, "supervisorId": 2, "firstName": "Wang", "lastName": "Mercedes", "Category": { "ID": 1, "Name": "Name1" } },

            // Steve Buchanan's direct reports
            { "employeeId": 14, "supervisorId": 3, "firstName": "Theodore", "lastName": "Zia", "Category": { "ID": 2, "Name": "Name2" } },
            { "employeeId": 15, "supervisorId": 3, "firstName": "Lacota", "lastName": "Mufutau", "Category": { "ID": 0, "Name": "Name" } },

            // Lacota Mufutau's direct reports
            { "employeeId": 16, "supervisorId": 15, "firstName": "Jin", "lastName": "Elliott", "Category": { "ID": 0, "Name": "Name" } },
            { "employeeId": 17, "supervisorId": 15, "firstName": "Armand", "lastName": "Ross", "Category": { "ID": 0, "Name": "Name" } },
            { "employeeId": 18, "supervisorId": 15, "firstName": "Dane", "lastName": "Rodriquez", "Category": { "ID": 1, "Name": "Name1" } },

            // Dane Rodriquez's direct reports
            { "employeeId": 19, "supervisorId": 18, "firstName": "Declan", "lastName": "Lester", "Category": { "ID": 1, "Name": "Name1" } },
            { "employeeId": 20, "supervisorId": 18, "firstName": "Bernard", "lastName": "Jarvis", "Category": { "ID": 1, "Name": "Name1" } },

            // Bernard Jarvis' direct report
            { "employeeId": 21, "supervisorId": 20, "firstName": "Jeremy", "lastName": "Donaldson", "Category": { "ID": 2, "Name": "Name2" } }
		];

			$(document).ready(function () {

				// create the data sources
				tableDs = new $.ig.DataSource({ schema: { fields: [{ name: "col1", type: "number" }, { name: "col2", type: "number" },
			{ name: "col3" }, { name: "col4" }, { name: "col5", type: "date" }, { name: "col6", type: "boolean"}]
				},
					filtering: { type: "local" }, dataSource: $("#t1")[0]
				}).dataBind();

				jsonDs = new $.ig.DataSource({ filtering: { type: "local" }, dataSource: arrayOfDataObjects,
					paging: { enabled: true, type: "local", pageSize: 3 }
				}).dataBind();

				//data source with mapper
				mapperDs = new $.ig.DataSource({
					dataSource: northwindProductsJSON,
					schema: {
						fields: [{
							name: "ID", type: "number"
						}, {
							name: "Name", type: "string"
						}, {
							name: "Category", type: "object", mapper: function (record) {
								return record.Category.Name;
							}
						}]
					}
				}).dataBind();

				treeDs = new $.ig.TreeHierarchicalDataSource({
					dataSource: treeFlatData,
					treeDS: {
						key: "employeeId",
						foreignKey: "supervisorId",
						foreignKeyRootValue: -1,
						initialExpandDepth: 2,
						childDataKey: "childData"
					},
					schema: {
						fields: [{
							name: "employeeId", type: "number"
						}, {
							name: "supervisorId", type: "number"
						}, {
							name: "firstName", type: "string"
						},
						{
							name: "lastName", type: "string"
						},
						{
							name: "Category", type: "object", mapper: function (record) {
								return record.Category.ID;
							}
						}]
					}
				});
				treeDs.dataBind();

				// use jQuery templating to render the processed/transformed data source 
				var jsonDataView = jsonDs.dataView();
				$("#template1").tmpl(jsonDataView).appendTo("#list1");

				// we need to make sure our data is fresh and we get matches for "Today", "Before", "After", "Yesterday", "thisMonth", "NextMonth", "ThisYear", "NextYear", "LastYear"

				var yearsCount = { 'lastYear': 0, 'thisYear': 0, 'nextYear': 0 };
				var monthsCount = { 'lastMonth': 0, 'thisMonth': 0, 'nextMonth': 0 };

				date = new Date();
				before1 = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 1, 0, 0, 0, 0);
				before2 = new Date(date.getFullYear(), date.getMonth() - 1, date.getDate(), 0, 0, 0, 0);
				before3 = new Date(date.getFullYear() - 1, date.getMonth(), date.getDate(), 0, 0, 0, 0);

				after1 = new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1, 0, 0, 0, 0);
				after2 = new Date(date.getFullYear(), date.getMonth() + 1, date.getDate(), 0, 0, 0, 0);
				after3 = new Date(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours() + 1, 0, 0, 0);
				after4 = new Date(date.getFullYear() + 1, date.getMonth(), date.getDate(), 0, 0, 0, 0);

				after5 = new Date(date.getFullYear() + 2, date.getMonth(), date.getDate(), 0, 0, 0, 0);

				before4 = new Date(date.getFullYear() - 1, date.getMonth(), date.getDate(), 0, 0, 0, 0);
				before5 = new Date(date.getFullYear() - 2, date.getMonth(), date.getDate(), 0, 0, 0, 0);

				//today
				tableDs.dataView()[0].col5 = date;

				//before
				tableDs.dataView()[1].col5 = before1; // this month yesterday
				tableDs.dataView()[2].col5 = before2; // last month (this year)
				tableDs.dataView()[3].col5 = before3;  // last year 

				// after
				tableDs.dataView()[4].col5 = after1; // this month tomorrow
				tableDs.dataView()[5].col5 = after2; // this year (this month)
				tableDs.dataView()[6].col5 = after3; // this year (next month)
				tableDs.dataView()[7].col5 = after4; // next year

				tableDs.dataView()[8].col5 = after5;
				tableDs.dataView()[9].col5 = before4;
				tableDs.dataView()[10].col5 = before5;

				for (i = 0; i < tableDs.dataView().length; ++i) {
					if (tableDs.dataView()[i].col5.getFullYear() == (date.getFullYear() - 1)) {
						yearsCount['lastYear']++;
					} else if (tableDs.dataView()[i].col5.getFullYear() == (date.getFullYear())) {
						yearsCount['thisYear']++;
					} else if (tableDs.dataView()[i].col5.getFullYear() == (date.getFullYear() + 1)) {
						yearsCount['nextYear']++;
					}

					var lastMonth = date.getMonth() === 0 ? 11 : date.getMonth() - 1;
					var nextMonth = date.getMonth() === 11 ? 0 : date.getMonth() + 1;
					var tDate = tableDs.dataView()[i].col5;
					if ((tDate.getMonth() === date.getMonth() - 1 && tDate.getFullYear() === date.getFullYear())
					   || (tDate.getMonth() - 11 === date.getMonth() && tDate.getFullYear() === date.getFullYear() - 1)) {
						monthsCount['lastMonth']++;
					} else if (tableDs.dataView()[i].col5.getMonth() === date.getMonth() && tDate.getFullYear() === date.getFullYear()) {
						monthsCount['thisMonth']++;
					} else if ((tDate.getMonth() === date.getMonth() + 1 && tDate.getFullYear() === date.getFullYear())
					   || (tDate.getMonth() + 11 === date.getMonth() && tDate.getFullYear() === date.getFullYear() + 1)) {
						monthsCount['nextMonth']++;
					}
				}

				startTesting();

				function startTesting() {

					$(function () {

						QUnit.init();
						QUnit.start();

						module("igDataSource");

						var testId_1 = "IgDataSource filtering test 1: Filtering with schema - StartsWith";
						var testId_2 = "IgDataSource filtering test 2: Filtering with schema - EndsWith";
						var testId_3 = "IgDataSource filtering test 3: Filtering with schema - Contains";
						var testId_4 = "IgDataSource filtering test 4: Filtering with schema - DoesNotContain";
						var testId_5 = "IgDataSource filtering test 5: Filtering with schema - Equals";
						var testId_6 = "IgDataSource filtering test 6: Filtering with schema - DoesNotEqual";
						var testId_7 = "IgDataSource filtering test 7: Filtering with schema - GreaterThan";
						var testId_8 = "IgDataSource filtering test 8: Filtering with schema - LessThan";
						var testId_9 = "IgDataSource filtering test 9: Filtering with schema - GreaterThanOrEqualTo";
						var testId_10 = "IgDataSource filtering test 10: Filtering with schema - True";
						var testId_11 = "IgDataSource filtering test 11: Filtering with schema - False";
						var testId_12 = "IgDataSource filtering test 12: Filtering with schema - After";
						var testId_13 = "IgDataSource filtering test 13: Filtering with schema - Before";
						var testId_14 = "IgDataSource filtering test 14: Filtering with schema - Today";
						var testId_15 = "IgDataSource filtering test 15: Filtering with schema - Yesterday";
						var testId_16 = "IgDataSource filtering test 16: Filtering with schema - ThisMonth";
						var testId_17 = "IgDataSource filtering test 17: Filtering with schema - LastMonth";
						var testId_18 = "IgDataSource filtering test 18: Filtering with schema - NextMonth";
						var testId_19 = "IgDataSource filtering test 19: Filtering with schema - ThisYear";
						var testId_20 = "IgDataSource filtering test 20: Filtering with schema - LastYear";
						var testId_21 = "IgDataSource filtering test 20: Filtering with schema - NextYear";

						var testId_22 = "IgDataSource filtering test 20: Filtering without schema by Index - Contains";
						var testId_23 = "IgDataSource filtering test 20: Filtering without schema by Index - GreaterThan";
						var testId_24 = "IgDataSource filtering test 20: Filtering without schema by Index - Before";
						var testId_25 = "IgDataSource filtering test 20: Filtering without schema by Index - Equals";

						var testId_26 = "IgDataSource filtering test 20: Filtering with expressions array - multiple 1";
						var testId_27 = "IgDataSource filtering test 20: Filtering with expressions array - multiple 2";
						var testId_28 = "IgDataSource filtering test 20: Filtering with expression string  1";
						var testId_29 = "IgDataSource filtering test 20: Filtering with expression string 2";

						var testId_30 = "IgDataSource filtering test 20: Filtering with expression string 3 - not like SQL";
						var testId_31 = "IgDataSource filtering test 20: Filtering with expression string 4 - greater than or equal SQL";
						var testId_32 = "IgDataSource filtering test 20: Filtering with expression string 5 - less than or equal SQL";

						var testId_33 = "IgDataSource filtering test 33: filtering with RegExp";
						var testId_34 = "IgDataSource filtering test 34: Filtering field with mapper function defined";
						var testId_35 = "IgTreeHierarchicalDataSource filtering test 35-  Filtering field with mapper function defined";

						// IgDataSource filtering test 1: Filtering with schema - StartsWith
						test(testId_1, function () {

							tableDs.filter([{ fieldName: "col3", expr: "l", cond: "startsWith"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 2, 2);
							// 2. check that they both start with "l"
							equal("Laptop", tableDs.dataView()[0].col3, "Laptop");
							equal("Laptop", tableDs.dataView()[1].col3, "Laptop");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "startsWith"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");
						});

						// IgDataSource filtering test 2: Filtering with schema - EndsWith
						test(testId_2, function () {

							tableDs.filter([{ fieldName: "col3", expr: "r", cond: "endsWith"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 2, 2);
							// 2. check that they both start with "l"
							equal("Hamburger", tableDs.dataView()[0].col3, "Hamburger");
							equal("Beer", tableDs.dataView()[1].col3, "Beer");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "endsWith"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");
						});

						// IgDataSource filtering test 3: Filtering with schema - Contains
						test(testId_3, function () {

							tableDs.filter([{ fieldName: "col3", expr: "m", cond: "contains"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 4, 4);

							equal("Hamburger", tableDs.dataView()[0].col3, "Hamburger");
							equal("mouse", tableDs.dataView()[3].col3, "mouse");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "contains"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");

						});

						// IgDataSource filtering test 4: Filtering with schema - DoesNotContain
						test(testId_4, function () {

							tableDs.filter([{ fieldName: "col3", expr: "e", cond: "doesNotContain"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 4, 4);

							equal("Laptop", tableDs.dataView()[0].col3, "Laptop");
							equal("fish", tableDs.dataView()[2].col3, "fish");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "doesNotContain"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");

						});

						// IgDataSource filtering test 5: Filtering with schema - Equal
						test(testId_5, function () {

							tableDs.filter([{ fieldName: "col3", expr: "fish", cond: "equals"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 1, 1);
							equal("fish", tableDs.dataView()[0].col3, "fish");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "equals"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");

							// now test Equals for numeric and date columns 

							tableDs.filter([{ fieldName: "col2", expr: 987, cond: "equals"}], true);
							equal(tableDs.dataView().length, 1, 1);
							equal(987, tableDs.dataView()[0].col2, 987);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: date.toString(), cond: "equals"}], true);
							equal(tableDs.dataView().length, 1, 1);
							deepEqual(date, tableDs.dataView()[0].col5, date);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 6: Filtering with schema - DoesNotEqual
						test(testId_6, function () {

							tableDs.filter([{ fieldName: "col3", expr: "Laptop", cond: "doesNotEqual"}], true);

							// 1. check the number of records
							equal(tableDs.dataView().length, 9, 9);
							equal("Hamburger", tableDs.dataView()[0].col3, "Hamburger");

							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col3", expr: "", cond: "doesNotEqual"}], true);

							equal(tableDs.dataView().length, 11, 11);

							$("#t1 tbody").empty();
							$("#tableTemplate").tmpl(tableDs.dataView()).appendTo("#t1 tbody");

							// now test Does Not Equal for numeric and date columns 

							tableDs.filter([{ fieldName: "col2", expr: 987, cond: "doesNotEqual"}], true);
							equal(tableDs.dataView().length, 10, 10);
							equal(100, tableDs.dataView()[0].col2, 100);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "doesNotEqual"}], true);
							equal(tableDs.dataView().length, 11, 11);

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: date.toString(), cond: "doesNotEqual"}], true);
							equal(tableDs.dataView().length, 10, 10);
							//same(date, tableDs.dataView()[0].col5, date);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "doesNotEqual"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 7: Filtering with schema - GreaterThan
						test(testId_7, function () {

							// now test GreaterThan for numeric and date columns 

							tableDs.filter([{ fieldName: "col2", expr: 100, cond: "greaterThan"}], true);
							equal(tableDs.dataView().length, 4, 4);
							equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "greaterThan"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 8: Filtering with schema - LessThan
						test(testId_8, function () {

							tableDs.filter([{ fieldName: "col2", expr: 100, cond: "lessThan"}], true);
							equal(tableDs.dataView().length, 5, 5);
							equal(15, tableDs.dataView()[0].col2, 15);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "lessThan"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 9: Filtering with schema - GreaterThanOrEqualTo
						test(testId_9, function () {

							tableDs.filter([{ fieldName: "col2", expr: 100, cond: "greaterThanOrEqualTo"}], true);
							equal(tableDs.dataView().length, 6, 6);
							equal(100, tableDs.dataView()[0].col2, 100);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "greaterThanOrEqualTo"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 10: Filtering with schema - True
						test(testId_10, function () {

							tableDs.filter([{ fieldName: "col6", cond: "true"}], true);
							equal(tableDs.dataView().length, 6, 6);
							equal(true, tableDs.dataView()[0].col6, true);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col6", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 11: Filtering with schema - False
						test(testId_11, function () {

							tableDs.filter([{ fieldName: "col6", cond: "false"}], true);
							equal(tableDs.dataView().length, 5, 5);
							equal(false, tableDs.dataView()[0].col6, false);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col6", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 12: Filtering with schema - After
						test(testId_12, function () {

							tableDs.filter([{ fieldName: "col5", expr: new Date(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes() + 1, 0).toString(), cond: "after"}], true);
							equal(tableDs.dataView().length, 5, 5);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 13: Filtering with schema - Before
						test(testId_13, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: date.toString(), cond: "before"}], true);
							equal(tableDs.dataView().length, 5, 5);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 14: Filtering with schema - Today
						test(testId_14, function () {

							//dates 
                            var col5Date, countTodayRecords = 0, today = new Date(), y = today.getFullYear(), m = today.getMonth(), d = today.getDate();
                            for (i = 0; i < tableDs.dataView().length; ++i) {
                                col5Date = tableDs.dataView()[i].col5;
                                if (col5Date.getFullYear() === y && col5Date.getMonth() === m && col5Date.getDate() === d) {
                                    countTodayRecords++;
                                }
                            }
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "today"}], true);
							equal(tableDs.dataView().length, countTodayRecords, "Today count records should be " + countTodayRecords);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);

						});

						// IgDataSource filtering test 15: Filtering with schema - Yesterday
						test(testId_15, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "yesterday"}], true);
							equal(tableDs.dataView().length, 1, 1);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 16: Filtering with schema - ThisMonth
						test(testId_16, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "thisMonth"}], true);
							equal(tableDs.dataView().length, monthsCount['thisMonth'], monthsCount['thisMonth']);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 17: Filtering with schema - LastMonth
						test(testId_17, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "lastMonth"}], true);
							equal(tableDs.dataView().length, monthsCount['lastMonth'], monthsCount['lastMonth']);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 18: Filtering with schema - NextMonth
						test(testId_18, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "nextMonth"}], true);
							equal(tableDs.dataView().length, monthsCount['nextMonth'], monthsCount['nextMonth']);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 19: Filtering with schema - ThisYear
						test(testId_19, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "thisYear"}], true);
							equal(tableDs.dataView().length, yearsCount['thisYear'], yearsCount['thisYear']);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 20: Filtering with schema - LastYear
						test(testId_20, function () {
							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "lastYear"}], true);
							equal(tableDs.dataView().length, yearsCount['lastYear'], yearsCount['lastYear']);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 21: Filtering with schema - NextYear
						test(testId_21, function () {

							//dates 
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "nextYear"}], true);
							equal(tableDs.dataView().length, yearsCount['nextYear'], yearsCount['nextYear']);
							//equal(new Date("Wed Nov 10 00:00:00 UTC+0200 2010"), tableDs.dataView()[0].col5, new Date("Wed Nov 10 00:00:00 UTC+0200 2010"));
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col5", expr: "", cond: "equals"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 22: Filtering without schema by Index - Contains
						/*
						test(testId_22, function() {
						ok(true);
						});
			
						test(testId_23, function() {
						ok(true);
						});
			
						test(testId_24, function() {
						ok(true);
						});
			
						test(testId_25, function() {
						ok(true);
						});
						*/

						//IgDataSource filtering test 20: Filtering with expressions array - multiple 1 -  "AND logic"
						test(testId_26, function () {

							tableDs.filter([{ fieldName: "col2", expr: 100, cond: "greaterThan", logic: "AND" }, { fieldName: "col3", expr: "m", cond: "startsWith", logic: "AND"}], true);
							equal(tableDs.dataView().length, 2, 2);
							equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "greaterThan", logic: "AND" }, { fieldName: "col3", expr: "", cond: "startsWith", logic: "AND"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						//IgDataSource filtering test 20: Filtering with expressions array - multiple 2 -  "OR logic"
						test(testId_27, function () {

							tableDs.filter([{ fieldName: "col2", expr: 100, cond: "greaterThan", logic: "OR" }, { fieldName: "col3", expr: "m", cond: "startsWith", logic: "OR"}], true);
							equal(tableDs.dataView().length, 4, 4);
							equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter([{ fieldName: "col2", expr: "", cond: "greaterThan", logic: "OR" }, { fieldName: "col3", expr: "", cond: "startsWith", logic: "OR"}], true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 28: Filtering with expression string  1 -  "AND logic"
						test(testId_28, function () {

							tableDs.filter("col2 > 100 AND col3 LIKE m%", true);
							equal(tableDs.dataView().length, 2, 2);
							equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter("", true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 29: Filtering with expression string  2 - "OR logic"
						test(testId_29, function () {

							tableDs.filter("col2 > 100 OR col3 LIKE m%", true);
							equal(tableDs.dataView().length, 4, 4);
							equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter("", true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 30: Filtering with expression string 3 - not like SQL
						test(testId_30, function () {

							tableDs.filter("col2 <> 100", true);
							equal(tableDs.dataView().length, 9, 9);
							//equal(2000, tableDs.dataView()[0].col2, 2000);
							// remove the filter and check if all records are back there
							tableDs.filter("", true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 31: Filtering with expression string 3 - greater than or equal
						test(testId_31, function () {

							tableDs.filter("col2 >= 100", true);
							equal(tableDs.dataView().length, 6, 6);
							equal(100, tableDs.dataView()[0].col2, 100);
							// remove the filter and check if all records are back there
							tableDs.filter("", true);
							equal(tableDs.dataView().length, 11, 11);
						});

						// IgDataSource filtering test 32: Filtering with expression string 3 - less than or equal
						test(testId_32, function () {

							tableDs.filter("col2 <= 100", true);
							equal(tableDs.dataView().length, 7, 7);
							equal(100, tableDs.dataView()[0].col2, 100);
							// remove the filter and check if all records are back there
							tableDs.filter("", true);
							equal(tableDs.dataView().length, 11, 11);
						});

						test(testId_34, function () {
							mapperDs.filter([{ fieldName: "Category", expr: "Electronics", cond: "contains" }], "AND", true);

							equal(mapperDs.dataView().length, 2, "There should be 2 records that match the filtering condition.");
							equal(mapperDs.dataView()[0].Category.Name, "Electronics", "DataView should be filtered correctly.");
							equal(mapperDs.dataView()[1].Category.Name, "Electronics", "DataView should be filtered correctly.");
						});

						test(testId_35, function () {
							treeDs.filter([{ fieldName: "Category", expr: 1 , cond: "lessThan" }], "AND", true);
							
							$(treeDs.flatDataView()).each(function () {
								equal(this.__matchFiltering === true, this.Category.ID === 0, "Check if filtering parameter __matchFiltering was appled based on the mapped value: Category.ID");
							});
						});

					});
				}

			});
		
	QUnit.log = function(result, message)  
	{  
		if (window.console && window.console.log)  
		{  
			window.console.log(result +' :: '+ message);  
		}  
	} 
		
	</script>
	<!--  -->
</head>
<body>
<div id="div1"></div>
<div style="float:right;width:400px;overflow:auto"">
    <h1 id="qunit-header">Test results</h1>
     <h2 id="qunit-banner"></h2>
     <h2 id="qunit-userAgent"></h2>
     <ol id="qunit-tests"></ol>
</div>

	<table id="t1" cellpadding=5 cellspacing=0>
	<tbody>
	<tr> <td>1</td> <td>100</td> <td>Laptop</td>  <td>$ 1000 </td>  <td> 7/23/2010 </td>  <td>0</td> </tr>
	<tr> <td>2</td> <td>15</td> <td>Hamburger</td>  <td>$ 33 </td> <td> 10/29/2010 </td>  <td>0</td> </tr>
	<tr> <td>3</td> <td>2000</td> <td>mobile phone</td>  <td>$ 5454 </td> <td> 10/28/2010 </td> <td>1</td>  </tr>
	<tr> <td>4</td> <td>45</td> <td>Beer</td>  <td>$ 2323232 </td> <td> 11/10/2010 </td> <td>1</td> </tr>
	<tr> <td>5</td> <td>78</td> <td>trainers</td>  <td>$ 545454 </td> <td> 7/23/2009 </td> <td>0</td> </tr>
	<tr> <td>6</td> <td>32</td> <td>coffee cup</td>  <td>$ 22 </td> <td> 9/20/2010 </td> <td>1</td> </tr>
	<tr> <td>7</td> <td>987</td> <td>BMW 323 CI</td>  <td>$ 1000000 </td> <td> 7/23/2011 </td> <td>0</td> </tr>
	<tr> <td>8</td> <td>434343</td> <td>mouse</td>  <td>$ 545454 </td> <td> 11/1/2010 </td> <td>0</td> </tr>
	<tr> <td>9</td> <td>2356</td> <td>keyboard</td>  <td>$ 34 </td> <td> 5/20/2010 </td> <td>1</td> </tr>
	<tr> <td>10</td> <td>33</td> <td>fish</td>  <td>$ 22 </td><td> 8/10/2010 </td>  <td>1</td> </tr>
	<tr> <td>1</td> <td>100</td> <td>Laptop</td>  <td>$ 1000 </td><td> 7/23/2010 </td> <td>1</td>  </tr>
	</tbody>
	</table>

<br> <div style='display:inline;'> Filtering condition:
<select id="cond_list">
	<option value="StartsWith">Starts With</option>
	<option value="EndsWith">Ends With</option>
	<option value="Contains">Contains</option>
	<option value="DoesNotContain">Does Not Contain</option>
	<option value="Equals">Equals</option>
	<option value="DoesNotEqual">Does Not Equal</option>
	<option value="LessThan">Less Than</option>
	<option value="GreaterThan">Greater Than</option>
	<option value="Before">Before</option>
	<option value="After">After</option>
	<option value="Today">Today</option>
	<option value="Yesterday">Yesterday</option>
	<option value="LastMonth">Last Month</option>
</select>
</div>

<br><div style='display:inline;'><input id="filterCol2" name="filterCol2"/><input type="button" value="filter table col 2" onclick="filterCol2(); return false;" /></div>
<br><div style='display:inline;'><input id="filterCol3" name="filterCol3"/><input type="button" value="filter table col 3" onclick="filterCol3(); return false;" /></div>
<br><div style='display:inline;'><input id="filterCol5" name="filterCol5"/><input type="button" value="filter date col 5" onclick="filterCol5(); return false;" /></div>
<br><div style='display:inline;'><input id="filterCustom" name="filterCustom"/><input type="button" value="custom filter" onclick="filterCustom(); return false;" /></div>
<br><div style='display:inline;'><input type="button" value="filter table by col 2 AND col 3 (combined filter)" onclick="filterCol2AndCol3(); return false;" /></div>
<br><br>
<br><div style='display:inline;'><input id="firstName"/><input type="button" value="filter list by first name" onclick="filterJsonListByFirstName(); return false;" /></div>
<br><div style='display:inline;'><input id="lastName"/><input type="button" value="filter list by last name" onclick="filterJsonListByLastName(); return false;" /></div>

<ul id="list1">
</ul>


</body>
</html>