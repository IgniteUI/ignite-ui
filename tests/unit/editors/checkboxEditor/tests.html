<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<title>Infragistics jQuery Client Editors - Common </title>
	<meta charset="UTF-8" />
	<link type="text/css" href="../../../../src/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.shared.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.popover.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.notifier.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.editors.css" rel="stylesheet" />
	<!-- 	
	<script type="text/javascript" src="../../../../bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="../../../../bower_components/jquery-ui/jquery-ui.js"></script> -->

	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.popover-en.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.notifier-en.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.editors-en.js"></script>

	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.jquery.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.widget.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.popover.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.notifier.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.editors.js"></script>

	<link type="text/css" href="../../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
	<script type="text/javascript" src="../../../../bower_components/qunit/qunit/qunit.js"></script>

	<script type="text/javascript">
		QUnit.module("igCheckboxEditor unit tests", {
			label1Selector: "label1",
			chkInput1Selector: "chkInput1",
			label2Selector: "label2",
			chkInput2Selector: "chkInput2",
			label3Selector: "label3",
			chkInput3Selector: "chkInput3",
			chkContainerSelector: "chkContainer",
			chkSpanSelector: "chkSpan",
			chkLabelSelector: "chkLabel",
			chkInputcheSelector: "chkInputche",
			chkStyledSelector: "chkStyled",
			chkAttrSelector: "chkAttr",
			chkNullSelector: "chkNull",

			beforeEach: function () {
				$qunitFixture = $('#qunit-fixture');
				$qunitFixture.append($("<label></label>").attr({
					id: this.label1Selector,
					for: this.chkInput1Selector
				}).text("Label 1"));
				$qunitFixture.append($("<input></input>").attr("id", this.chkInput1Selector));
				$qunitFixture.append($("<label></label>").attr({
					id: this.label2Selector,
					for: this.chkInput2Selector
				}).text("Label 2"));
				$qunitFixture.append($("<input></input>").attr({
					id: this.chkInput2Selector,
					type: "checkbox"
				}));
				$qunitFixture.append($("<label></label>").attr({
					id: this.label3Selector,
					for: this.chkInput3Selector
				}).text("Label 3"));
				$qunitFixture.append($("<input></input>").attr({
					id: this.chkInput3Selector,
					"aria-labelledby": this.label3Selector
				}));
				$qunitFixture.append($("<div></div>").attr("id", this.chkContainerSelector));
				$qunitFixture.append($("<span></span>").attr("id", this.chkSpanSelector));
				$qunitFixture.append($("<label></label>").attr("id", this.chkLabelSelector));
				$qunitFixture.append($("<input></input>").attr("id", this.chkInputcheSelector));
				$qunitFixture.append($("<input></input>").attr("id", this.chkStyledSelector));
				$qunitFixture.append($("<span></span>").attr({
					id: this.chkAttrSelector,
					name: "name1",
					value: "value1",
					checked: "checked",
					readonly: "readonly",
					disabled: "disabled",
					"aria-labelledby": "aria-labelledby"
				}));
				$qunitFixture.append($("<input></input>").attr("id", this.chkNullSelector));

				$(this.id(this.chkInput1Selector)).igCheckboxEditor({
					tabIndex: 2
				});
				$(this.id(this.chkInput2Selector)).igCheckboxEditor();
				$(this.id(this.chkInput3Selector)).igCheckboxEditor({
					value: "accpetedRules",
					valueChanged: function (evt, ui) {
						// t/f	t/f value
						$("#chkInput3Row > td").eq(0).text(ui.owner._valueInput[0].checked);
						$("#chkInput3Row > td").eq(1).text(ui.newState);
						$("#chkInput3Row > td").eq(2).text(ui.newValue);
					}

				});
				$(this.id(this.chkContainerSelector)).igCheckboxEditor({
					checked: true,
					value: "Agree",
					inputName: "agree",
					tabIndex: 1
				});
				$(this.id(this.chkSpanSelector)).igCheckboxEditor();
				$(this.id(this.chkInputcheSelector)).igCheckboxEditor({
					width: 64,
					height: 48,
					tabIndex: 0,
					valueChanging: function (evts, args) {
						return false;
					}
				});

				$(this.id(this.chkStyledSelector)).igCheckboxEditor({
					iconClass: "ui-icon-close",
					checked: true
				});
				$(this.id(this.chkAttrSelector)).igCheckboxEditor();
				$(this.id(this.chkNullSelector)).igCheckboxEditor();
			},
			afterEach: function () {
			},
			id: function (selector) {
				return "#" + selector;
			}
		});

		QUnit.test('[ID1] Checkbox Editor initialization.', function (assert) {
			assert.expect(9);
			var $chkInput = $(this.id(this.chkInput1Selector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				$chkLabel = $(this.id(this.chkLabelSelector)),
				$chkSpan = $(this.id(this.chkSpanSelector));

			console.dir(this.error);

			assert.equal(typeof ($chkInput.igCheckboxEditor), 'function', "Editors Scripts not loaded");
			assert.notStrictEqual($chkContainer.data("igCheckboxEditor"), undefined,'Error creating igCheckboxEditor in a DIV');
			assert.notStrictEqual($chkInput.data("igCheckboxEditor"), undefined, 'Error creating igCheckboxEditor in an INPUT');
			assert.notStrictEqual($chkSpan.data("igCheckboxEditor"), undefined, 'Error creating igCheckboxEditor in a SPAN');
			assert.equal($chkInput.attr("type"), "checkbox", 'Type of igCheckboxEditor is not checkbox');
			assert.throws(function () {
					$chkLabel.igCheckboxEditor();
				},
				Error($.ig.Editor.locale.instantiateCheckBoxErrMsg),
				"igCheckboxEditor requires a different element. Use INPUT, SPAN or DIV element."
			);
			assert.equal($chkInput.data("igCheckboxEditor")._valueInput.attr("type"), "checkbox", 'Type of igCheckboxEditor is not checkbox');
			assert.equal($chkContainer.data("igCheckboxEditor")._valueInput.attr("type"), "checkbox", 'Type of igCheckboxEditor is not checkbox');
			assert.equal($chkContainer.igCheckboxEditor("inputName"), "agree", 'Input name shoud be set');
		});

		QUnit.test('[ID2] Check for stlye', function (assert) {
			assert.expect(12);
			var $chkInput = $(this.id(this.chkInput1Selector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				css = $chkInput.data("igCheckboxEditor").css;

			assert.ok($chkContainer.hasClass(css.containerChecked), "Checked container style not applied");
			assert.ok($chkContainer.hasClass(css.container.split(" ")[0]), "Container classes not applied");
			assert.ok($chkContainer.hasClass(css.container.split(" ")[1]), "Container classes not applied");
			assert.ok($chkContainer.hasClass(css.container.split(" ")[2]), "Container classes not applied");
			$chkContainer.mouseover();
			assert.ok($chkContainer.hasClass(css.hover), "Hover class not applied");
			$chkContainer.mousedown();
			assert.ok($chkContainer.hasClass(css.active), "Active class not applied");
			assert.ok($chkContainer.igCheckboxEditor("editorContainer").hasClass(css.focus), "Focus class not applied");
			assert.ok($chkContainer.hasClass(css.containerChecked), "Checked class not applied on the container");
			$chkContainer.mouseup();
			$chkContainer.mouseout();

			$chkContainer.igCheckboxEditor("toggle");
			assert.ok(!$chkContainer.hasClass(css.containerChecked), "Checked class not removed form the container");
			$chkContainer.igCheckboxEditor("toggle");

			$chkInput.mouseover();
			assert.ok($chkInput.data("igCheckboxEditor")._editorContainer.hasClass(css.hover), "Hover class not applied");
			$chkInput.mousedown();
			assert.ok($chkInput.data("igCheckboxEditor")._editorContainer.hasClass(css.active), "Active class not applied");
			assert.ok($chkInput.data("igCheckboxEditor")._editorContainer.hasClass(css.focus), "Focus class not applied");
			$chkInput.mouseup();
			$chkInput.mouseout();
		});

		QUnit.test('[ID3] Check for checked', function (assert) {
			assert.expect(15);
			var $chkInput = $(this.id(this.chkInput1Selector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				$chkSpan = $(this.id(this.chkSpanSelector));

			assert.ok(isChecked($chkInput, false), 'The initial value is not as expexted');
			assert.ok(isChecked($chkContainer, "Agree", true), 'The initial value is not as expexted');
			assert.ok(isValueChanged($chkContainer, "Agree"), 'The value attribute is not as expected');
			$chkContainer.igCheckboxEditor("option", "value", "Don't agree");
			assert.ok(isValueChanged($chkContainer, "Don't agree"), 'The value attribute is not as expected');
			$chkInput.click();
			assert.ok(isChecked($chkInput, true), 'The value is not updated properly');
			$chkInput.click().click().click().click().click().blur().click().click();
			assert.ok(isChecked($chkInput, false), 'The value is not updated properly');
			$chkInput.igCheckboxEditor("toggle");
			assert.ok(isChecked($chkInput, true), 'The value after toggle is not updated correctly');
			$chkInput.igCheckboxEditor("toggle");
			assert.ok(isChecked($chkInput, false), 'The value after toggle is not updated correctly');
			$chkContainer.igCheckboxEditor("value", false);
			assert.ok(isValueChanged($chkContainer, false), 'The value after toggle is not updated correctly');
			// Set the value as string
			$chkContainer.igCheckboxEditor("value", "true");
			assert.ok(isValueChanged($chkContainer, "true"), 'The value after toggle is not updated correctly');
			$chkContainer.igCheckboxEditor("value", "false");
			$chkInput.igCheckboxEditor("value", true);
			assert.ok(isChecked($chkInput, true), 'The value is not updated properly');
			assert.throws(function () {
					$chkInput.igCheckboxEditor("value", "fail");
				},
				Error($.ig.Editor.locale.cannotParseNonBoolValue),
				"igCheckboxEditor acepted wrong value."
			);
			assert.ok(isChecked($chkInput, true), 'The value is not updated properly');
			fireKeyEvent($chkInput, 32);
			assert.ok(isChecked($chkInput, false), 'The value is not updated properly');
			assert.equal($chkSpan.igCheckboxEditor("field").attr("id"), $chkSpan.attr("id"),
				"editorInput is equal to the input");
		});

		QUnit.test('[ID4] Check width/height', function (assert) {
			assert.expect(7);
			var $chkInput = $(this.id(this.chkInputcheSelector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				css = $chkInput.data("igCheckboxEditor").css;

			// Default stlye from CSS
			assert.equal($chkContainer.igCheckboxEditor("editorContainer").css("width"), "16px", "Width is not correct");
			assert.equal($chkContainer.igCheckboxEditor("editorContainer").css("height"), "16px", "Height is not correct");

			$chkContainer.igCheckboxEditor("option", "width", 32);
			$chkContainer.igCheckboxEditor("option", "height", 32);
			assert.equal($chkContainer.igCheckboxEditor("editorContainer").css("width"), "32px", "Width is not correct");
			assert.equal($chkContainer.igCheckboxEditor("editorContainer").css("height"), "32px", "Height is not correct");
			assert.ok($chkContainer.igCheckboxEditor("field").hasClass(css.iconCentered), "Style is not applied");

			// Style set from the options
			assert.equal($chkInput.igCheckboxEditor("editorContainer").css("width"), "64px", "Width is not correct");
			assert.equal($chkInput.igCheckboxEditor("editorContainer").css("height"), "48px", "Height is not correct");
		});

		QUnit.test('[ID5] Disabled/readonly and other options and methods', function (assert) {
			assert.expect(7);
			var $chkInput = $(this.id(this.chkInput1Selector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				$chkSpan = $(this.id(this.chkSpanSelector)),
				$chkAttr = $(this.id(this.chkAttrSelector));

			$chkContainer.igCheckboxEditor("option", "readOnly", true);
			$chkContainer.click();
			assert.ok(isChecked($chkContainer, "Agree", true), 'Read only should not allow the value to changed');
			$chkContainer.igCheckboxEditor("option", "readOnly", false);

			$chkContainer.igCheckboxEditor("option", "disabled", true);
			assert.ok(isDisabled($chkContainer, true), 'The checkbox is not disabled');
			$chkContainer.igCheckboxEditor("option", "disabled", false);
			$chkContainer.igCheckboxEditor("option", "disabled", false); // Set the same value in order to have coverage
			assert.ok(isDisabled($chkContainer, false), 'The checkbox is not enabled');
			$chkContainer.igCheckboxEditor("option", "fake", false); // Set fake value in order to have coverage
			$chkContainer.igCheckboxEditor("inputName", "notagree");
			assert.equal($chkContainer.igCheckboxEditor("inputName"), "notagree", 'Input name is not changed');

			$chkSpan.igCheckboxEditor("option", "checked", false);
			$chkSpan.igCheckboxEditor("option", "size", "large");
			$chkSpan.igCheckboxEditor("option", "checked", true);
			assert.equal($chkSpan.igCheckboxEditor("value"), true, "Not checked");
			assert.ok($chkSpan.data("igCheckboxEditor")._editorInput.hasClass("ui-igcheckbox-large-on"),
				"Large style not applied");
			$chkAttr.igCheckboxEditor("option", "disabled", false);
			$chkAttr.click();
			assert.ok($chkAttr.igCheckboxEditor("option", "checked", true), "Should stay as checked");
		});

		QUnit.test('[ID6] Check styled properties', function (assert) {
			assert.expect(2);
			var $chk = $(this.id(this.chkStyledSelector));
			assert.ok($chk.data("igCheckboxEditor")._editorInput.hasClass("ui-icon-close"), "Close icon not applied");
			$chk.igCheckboxEditor("option", "iconClass", "ui-icon-plus");
			assert.ok($chk.data("igCheckboxEditor")._editorInput.hasClass("ui-icon-plus"), "Plus icon not applied");
		});

		QUnit.test('[ID7] Check events', function (assert) {
			assert.expect(1);
			$chkInput = $(this.id(this.chkInputcheSelector));

			$chkInput.click();
			assert.ok(isChecked($chkInput, false),
				'The value should not be checked, cause the valueChanging event is canceled');
		});

		QUnit.test('[ID8] Check destroy', function (assert) {
			assert.expect(11);
			var $chkInput = $(this.id(this.chkInput1Selector)),
				$chkContainer = $(this.id(this.chkContainerSelector)),
				$chkAttr = $(this.id(this.chkAttrSelector));
			// Put some wrong value to the true/false values and expect an exception
			$chkInput.val("fail");

			assert.throws(function () {
					$chkInput.igCheckboxEditor("value");
				},
				Error($.ig.Editor.locale.cannotParseNonBoolValue),
				"igCheckboxEditor acepted wrong value."
			);

			$chkInput.igCheckboxEditor("destroy");
			$chkContainer.igCheckboxEditor("destroy");
			assert.equal($chkInput.data("igCheckboxEditor"), undefined, 'Error destroying igCheckboxEditor in an input');
			assert.equal($chkContainer.data("igCheckboxEditor"), undefined, 'Error destroying igCheckboxEditor in a div');
			$._data($chkInput[0], "events");
			$._data($chkContainer[0], "events");
			assert.ok($chkInput.attr("class") === undefined, "Some classes are still not removed");
			assert.ok($chkContainer.attr("class") === undefined, "Some classes are still not removed");

			// Are the attributes recovered
			$chkAttr.igCheckboxEditor("destroy");
			assert.equal($chkAttr.attr("name"), "name1", "Attr is not recovered after destroying");
			assert.equal($chkAttr.attr("value"), "value1", "Attr is not recovered after destroying");
			assert.equal($chkAttr.attr("checked"), "checked", "Attr is not recovered after destroying");
			assert.equal($chkAttr.attr("readonly"), "readonly", "Attr is not recovered after destroying");
			assert.equal($chkAttr.attr("disabled"), "disabled", "Attr is not recovered after destroying");
			assert.equal($chkAttr.attr("aria-labelledby"), "aria-labelledby", "Attr is not recovered after destroying");
		});

		QUnit.test('[ID9] Check label click support', function (assert) {
			debugger;
			assert.expect(8);
			var $chkInput2 = $(this.id(this.chkInput2Selector)),
				$chkLabel2 = $(this.id(this.label2Selector)),
				$chkInput3 = $(this.id(this.chkInput3Selector)),
				$chkLabel3 = $(this.id(this.label3Selector));

			// state == value, state != internal
			click($chkLabel2[0]); // only native click works for labels
			assert.ok(isChecked($chkInput2, true, true), 'Clicking the label did not toggle the ckeckbox');
			assert.strictEqual($chkInput2.data("igCheckboxEditor")._valueInput[0].checked, true, "Internal input checked was modified incorrectly without explicit value!");
			click($chkLabel2[0]);
			assert.ok(isChecked($chkInput2, false, false), 'Clicking the label did not toggle the ckeckbox');
			assert.strictEqual($chkInput2.data("igCheckboxEditor")._valueInput[0].checked, true, "Internal input checked was modified incorrectly without explicit value!");

			// state != value, state == internal
			click($chkLabel3[0]); // only native click works for labels
			assert.ok(isChecked($chkInput3, "accpetedRules", true), 'Clicking the label did not toggle the ckeckbox');
			assert.strictEqual($chkInput3.data("igCheckboxEditor")._valueInput[0].checked, true, "Internal input checked was modified incorrectly without explicit value!");
			click($chkLabel3[0]);
			assert.ok(isChecked($chkInput3, "accpetedRules", false), 'Clicking the label did not toggle the ckeckbox');
			assert.strictEqual($chkInput3.data("igCheckboxEditor")._valueInput[0].checked, false, "Internal input checked was modified incorrectly without explicit value!");
		});

		QUnit.test('[ID10] Check focus using the focus API', function (assert) {
			assert.expect(5);
			var done = assert.async(),
				$chk = $(this.id(this.chkStyledSelector)),
				$chk1 = $(this.id(this.chkInput2Selector)),
				css = $chk.data("igCheckboxEditor").css;
			$chk.igCheckboxEditor("setFocus");
			assert.ok($chk.igCheckboxEditor("editorContainer").hasClass(css.focus), "Focus class not applied");
			assert.ok($(document.activeElement).html() === $chk.igCheckboxEditor("editorContainer").html(), "Focus class not applied");
			$chk1.igCheckboxEditor("setFocus");
			assert.ok($chk1.igCheckboxEditor("editorContainer").hasClass(css.focus), "Focus class not removed");

			var $chkEditor = $('<input/>').appendTo("#qunit-fixture").igCheckboxEditor({
				checked: true
			});
			$chkEditor.igCheckboxEditor("setFocus", 500);
			assert.ok(!$chkEditor.igCheckboxEditor("editorContainer").hasClass(css.focus), "Focus class should not be still applied");
			setTimeout(function () {
				assert.ok($chkEditor.igCheckboxEditor("editorContainer").hasClass(css.focus), "Focus class should be applied");
				$chkEditor.remove();
				done();
			}, 500);
		});

		QUnit.test('[ID11] Check exception when setting null', function (assert) {
			assert.expect(1);

			assert.throws(
				function () {
					$(this.id(this.chkNullSelector)).igCheckboxEditor("value", null);
				},
				Error($.ig.Editor.locale.cannotSetNonBoolValue),
				$.ig.Editor.locale.cannotSetNonBoolValue);
		});

		QUnit.test('[ID12]Testing key code event arguments', function (assert) {
			assert.expect(3);
			var done = assert.async(),
				keyD,
				keyP,
				keyU;

			$chkInput = $('<input/>').appendTo('#qunit-fixture').igCheckboxEditor({
				keydown: function (e, args) {
					keyD = args.key;
				},
				keypress: function (e, args) {
					keyP = args.key;
				},
				keyup: function (e, args) {
					keyU = args.key;
				}
			});

			fireKeyEvent($chkInput, 32);
			setTimeout(function () {
				assert.ok(keyD === 32, "Key code is not correct in keyDown event");
				assert.ok(keyP === 32, "Key code is not correct in keyPress event");
				assert.ok(keyU === 32, "Key code is not correct in keyUp event");
				$chkInput.remove();
				done();
			}, 300);
		});

		function isChecked($input, expectedValue, expectedState) {
			var one = $input.igCheckboxEditor("value") === expectedValue;
			var two = $input.data("igCheckboxEditor").options.checked === (expectedState !== undefined ? expectedState : expectedValue);
			return $input.igCheckboxEditor("value") === expectedValue &&
				$input.data("igCheckboxEditor").options.checked === (expectedState !== undefined ? expectedState : expectedValue);
		}

		function isValueChanged($input, expectedValue) {
			return $input.igCheckboxEditor("option", "value") === expectedValue &&
				$input.data("igCheckboxEditor").options.value === expectedValue;
		}

		function isDisabled($input, expectedValue) {
			return $input.igCheckboxEditor("option", "disabled") === expectedValue &&
				$input.data("igCheckboxEditor").options.disabled === expectedValue &&
				$input.data("igCheckboxEditor")._editorInput.prop("disabled") === expectedValue;
		}

		function fireKeyEvent(chk, keyCode) {
			var e = jQuery.Event("keydown");
			e.keyCode = keyCode;
			e.which = keyCode; // Press Space
			chk.trigger(e);
			e = jQuery.Event("keypress");
			e.keyCode = keyCode;
			e.which = keyCode;
			chk.trigger(e);
			e = jQuery.Event("keyup");
			e.keyCode = keyCode;
			e.which = keyCode;
			chk.trigger(e);
		}

		function click(el) {
			var ev = document.createEvent("MouseEvent");
			ev.initMouseEvent(
				"click",
				true /* bubble */ , true /* cancelable */ ,
				window, null,
				0, 0, 0, 0, /* coordinates */
				false, false, false, false, /* modifier keys */
				0 /*left*/ , null
			);
			el.dispatchEvent(ev);
		}
	</script>
</head>

</html>