<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8" />
	<title>Infragistics jQuery Client Editors - Mask Editors </title>
	<link type="text/css" href="../../../../src/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.popover.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.notifier.css" rel="stylesheet" />
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.editors.css" rel="stylesheet" />

	<script type="text/javascript" src="../../../../bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="../../../../bower_components/jquery-ui/jquery-ui.js"></script>

	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.popover-en.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.notifier-en.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.editors-en.js"></script>

	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.jquery.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.widget.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.popover.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.notifier.js"></script>  
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.editors.js"></script>

	<link type="text/css" href="../../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
	<script type="text/javascript" src="../../../../bower_components/qunit/qunit/qunit.js"></script>
	<script type="text/javascript" src="../../common/test-util.js"></script>

	<script type="text/javascript">
	/*global window, setTimeout, $, startTesting, QUnit, module, test, ok, equals*/
		$(document).ready(function () {
			// Create a editors
			function loadTestbeds() {
				$(function () {
					 $("#maskEditorRequired").igMaskEditor({
						inputMask: "LL00C",
						emptyChar: "*",
						value: "aa1"
					});   
					$("#editor1").igMaskEditor({
						value: "CCC",
						width: 400,
						inputName: "firstName",
						selectionOnFocus: "selectAll",
						buttonType: "clear",
						maxLength: 1,
						listItems: [1, 2, 3]
					});
					$("#editor11").igMaskEditor({
						value: "CCC",
						width: 400,
						inputName: "firstName",
						selectionOnFocus: "selectAll",
						buttonType: "clear",
						maxLength: 1,
						listItems: [1, 2, 3]
					});
					$("#editor2").igMaskEditor({
						includeKeys: "~!@#$%^&*(){}[]\\'*\"",
						selectionOnFocus: "browserDefault",
						inputMask: "NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C"
					});
					$("#editor233").igMaskEditor({
						inputMask: ">LLL00"
					});
					$("#editor364_1").igMaskEditor({
						inputMask: ">00"
					});
					$("#editor364_2").igMaskEditor({
						inputMask: "<00"
					});
					$("#editor364_3").igMaskEditor({
						inputMask: "<CC00CC"
					});
					$("#editor364_4").igMaskEditor({
						inputMask: ">CC00CC"
					});
					$("#editor3").igMaskEditor({
						
					});
					$("#editor4").igMaskEditor({
						excludeKeys: "~!@#$%^&*(){}[]\\'*\"",
					});
					try {
						$("#editor5").igMaskEditor({
							inputName: 'firstName',
							tabIndex: 2,
							buttonType: "dropdown",
							placeHolder: "enter a value",
						});
					} catch (e) { }
					
					$("#editor6").igMaskEditor({
						inputMask: "990",
						//dataMode: "rawText",
						promptChar: "_",
						padChar: "~",
						emptyChar: "?",
						value: 34
					});

					$("#editor7").igMaskEditor({
						buttonType: "clear",
						width: 300,
						height: 70
					});

					var listData = []
					for (var i = 1; i < 30; i++) {
						listData.push("item" + i);
					}

					$('#divEditor').igMaskEditor({
						width: "380",
						inputName: "firstName",
						selectionOnFocus: "selectAll",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C'

					});
					$('#rawTextEditor').igMaskEditor({
						width: "380",
						dataMode: "rawText",
						inputName: "firstName",
						selectionOnFocus: "atStart",
						placeHolder: "Enter Val",
						emptyChar: "%",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: '',

					});
					$('#rawTextWithRequiredPromptsEditor').igMaskEditor({
						width: "380",
						dataMode: "rawTextWithRequiredPrompts",
						inputName: "firstName",
						selectionOnFocus: "atEnd",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: '',

					});
					$('#rawTextWithAllPromptsEditor').igMaskEditor({
						width: "380",
						dataMode: "rawTextWithAllPrompts",
						inputName: "rawTextWithAllPrompts",
						selectionOnFocus: "browserDefault",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: '',

					});
					$('#rawTextWithLiteralsEditor').igMaskEditor({
						width: "380",
						dataMode: "rawTextWithLiterals",
						inputName: "rawTextWithLiterals",
						selectionOnFocus: "selectAll",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: '',

					});
					$('#rawTextWithRequiredPromptsAndLiteralsEditor').igMaskEditor({
						width: "380",
						dataMode: "rawTextWithRequiredPromptsAndLiterals",
						inputName: "firstName",
						selectionOnFocus: "selectAll",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: ''

					});

					$('#maskeditorList').igMaskEditor({
						width: "380",
						buttonType: "dropdown,spin,clear",
						listItems: listData,
						dataMode: "rawTextWithRequiredPromptsAndLiterals",
						inputName: "firstName",
						selectionOnFocus: "selectAll",
						placeHolder: "Enter Val",
						inputMask: 'NMK\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C',
						value: '',

					});
					//#unfilledCharsPromptEditor1
					$("#unfilledCharsPromptEditor1").igMaskEditor({
						width: '150',
						placeHolder: 'Phone',
						inputMask: '099-999-99',
						unfilledCharsPrompt: '0',
					});
					$("#unfilledCharsPromptEditor2").igMaskEditor({
						width: '150',
						placeHolder: 'Phone',
						inputMask: '099-999-99',
						unfilledCharsPrompt: '0',
						value: "45000403"
					});
					// rawTextWithRequiredPromptsAndLiteralsEditor
					$("#getValues").click(function () {
						var result = "";
						result += "allTextEidtor: ";
						result += $('#divEditor').igMaskEditor("value");
						result += "<br />";

						result += "rawTextEditor: ";
						result += $('#rawTextEditor').igMaskEditor("value");
						result += "<br />";

						result += "rawTextWithRequiredPromptsEditor: ";
						result += $('#rawTextWithRequiredPromptsEditor').igMaskEditor("value");
						result += "<br />";

						result += "rawTextWithAllPromptsEditor: ";
						result += $('#rawTextWithAllPromptsEditor').igMaskEditor("value");
						result += "<br />";

						result += "rawTextWithLiteralsEditor: ";
						result += $('#rawTextWithLiteralsEditor').igMaskEditor("value");
						result += "<br />";

						result += "rawTextWithRequiredPromptsAndLiteralsEditor: ";
						result += $('#rawTextWithRequiredPromptsAndLiteralsEditor').igMaskEditor("value");
						result += "<br />";

						$("#valuesContainer").empty();
						$("#valuesContainer").append(result);
					});

					$("form").submit(function (event) { });
					$("#toLowerEditor").igMaskEditor({
						toLower: true
					});
					$("#toUpperEditor").igMaskEditor({
						toUpper: true

					});
					
					$("#toUppertoLowerMaskEditor").igMaskEditor({
						inputMask: "\\C>CC>CC<CC<\\?>C<C>C&"

					});
					$("#customNullValueEditor").igMaskEditor({
						allowNullValue: true,
						nullValue: "Zero",
						inputMask: "CCCC"
					});

					
					$("#nullValueEditor").igMaskEditor({
						allowNullValue: true,
						inputMask: "CCCC"

					});
					$("#notNullValueEditor").igMaskEditor({
						allowNullValue: false,
						inputMask: "CC&&",

					});
					$("#validInEditModeEditor").igMaskEditor({
						inputMask: "&&00"
					});
					$("#pasteHandlerInput").igMaskEditor({
						inputMask: "CCR00"
					});
					$("#pasteHandlerInput1").igMaskEditor({
						inputMask: "CCR00"
					});

					$("#pasteEditor").igMaskEditor({
						inputMask: "00-0L/>aa(test)"
					});	
					
					$("#keydownEditor1").igMaskEditor({
						inputMask: ">?CC",
						value: "VAL"
					});
					$("#keydownEditor2").igMaskEditor({
						inputMask: "<ACC",
						value: "val"
					});
					$("#keydownEditor3").igMaskEditor({
						inputMask: "###"
						
					});
					$("#revertEditor1").igMaskEditor({
						inputMask : "9900",
						revertIfNotValid: true
					});
					$("#revertEditor2").igMaskEditor({
						inputMask : "CCC000"
					});
					$("#revertEditor3").igMaskEditor({
		              inputMask : "9900",
		              revertIfNotValid: true,
		              valueChanged: function (evt, ui) {
		                    $("#test").append("<span></span>");
		                }
					});
					$("#maskEditorRuntime").igMaskEditor({
						inputMask: "CCC"
					});
					$("#clearButton_439").igMaskEditor({
						inputMask: "CCCCCCC",
						buttonType: "clear"
					})

				});
			}
			initialized = false;
			module("igMaskEditor", {
				setup: function () {
					//pause testing until editors are initialized
					if (!initialized) {
						stop();
						loadTestbeds();
						setTimeout(function () { start(); }, 100);
						initialized = true;
					}
				},
				teardown: function () {
				}
			});

			testId = 'mask editor cannot set on runtime';
			test(testId, 2, function () {
				throws(function () {
					$('#maskEditorRuntime').igMaskEditor("option", "excludeKeys", "asds")
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.setOptionError) > -1;
				}, $.ig.Editor.locale.setOptionError + "excludeKeys");

				
				throws(function () {
					$('#maskEditorRuntime').igMaskEditor("option", "unfilledCharsPrompt", "*")
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.setOptionError) > -1;
				}, $.ig.Editor.locale.setOptionError + "unfilledCharsPrompt");
			});

			var testId = 'Mask Editor initialization.';
			test(testId, 4, function () {
				ok(typeof ($("#editor1").igMaskEditor) === 'function', "Editors Script is not loaded");
				ok($('#editor1').data("igMaskEditor") !== undefined, 'Error creating igMaskEditor in an input');
				equal($('#editor1').igMaskEditor("value"), "CCC", 'The initial value is not as expexted');
				equal($("#maskEditorRequired").igMaskEditor("value"), "aa1*", 'The initial value is not as expexted');

			});


			var testId = 'Mask Editor test typing.';
			test(testId, 9, function () {
				var editor = $('#editor4');

				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("a_________");
				checkMaskState(editor, 65, "a_________", "a", "a");

				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("ab________");
				checkMaskState(editor, 66, "ab________", "ab", "ab");

				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abc_______");
				checkMaskState(editor, 67, "abc_______", "abc", "abc");
			});

			testId = "Events testing";
			test(testId, 4, function () {
				//id=editor4
				var $editor6 = $('#editor6'),
					textChanged = 0,
					editorInput = $editor6.igMaskEditor("field"),
					text;

				editorInput.on("keypress.test", function (e) {
					var cursor = this.selectionStart;
					// mask validation resets value and selects the char to be replaced by the press:
					this.value = this.value.slice(0, this.selectionStart) + String.fromCharCode(e.charCode) + this.value.substr(this.selectionEnd);
					// push cursor to next position
					this.setSelectionRange(cursor + 1, cursor + 1);
				});
				$editor6.igMaskEditor("setFocus");
				stop();
				setTimeout(function () {
					// move to first position (don't replace prev. value)
					editorInput[0].setSelectionRange(0,0);
					$editor6.on("igmaskeditortextchanged", function (evt, args) {
						equal(args.text, text, "Text changed event is not fired with correct new value");
						textChanged++;
					});
					start();
					text = editorInput.val();
					text = text.substr(0, textChanged) + "1" + text.substr(textChanged + 1, text.length);
					keyInteraction(text.charCodeAt(textChanged), editorInput);
					equal(textChanged, 1, "textChanged event not fired");
					text = text.substr(0, textChanged) + "2" + text.substr(textChanged + 1, text.length);
					keyInteraction(text.charCodeAt(textChanged), editorInput);
					equal(textChanged, 2, "textChanged event not fired");
					$editor6.off("igmaskeditortextchanged");
					editorInput.off("keypress.test");
					editorInput.blur();
				}, 200);
			});

			var testId = 'Mask Editor Options.';
			test(testId, 16, function () {
				var editor = $('#editor1');

				editor.igMaskEditor("option", "placeholder", "Enter Val");

				throws(function () {
					editor.igMaskEditor("option", "inputMask", "NM234K\\AOIU\\CY0FC9\\A&:C\\A\\L\\a\\9C");
				}, " Error should be thrown");

				editor = $('#editor4');

				editor.igMaskEditor("option", "dataMode", "rawText");
				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abcd______");
				checkMaskState(editor, 67, "abcd______", "abcd", "abcd");

				editor.igMaskEditor("option", "dataMode", "rawTextWithRequiredPrompts");
				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abcd______");
				checkMaskState(editor, 67, "abcd______", "abcd", "abcd");

				editor.igMaskEditor("option", "dataMode", "rawTextWithAllPrompts");
				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abcd______");
				checkMaskState(editor, 67, "abcd______", "abcd", "abcd      ");

				editor.igMaskEditor("option", "dataMode", "rawTextWithLiterals");
				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abcd______");
				checkMaskState(editor, 67, "abcd______", "abcd", "abcd");

				editor.igMaskEditor("option", "dataMode", "rawTextWithRequiredPromptsAndLiterals");
				editor.igMaskEditor("setFocus");
				editor.igMaskEditor("field").val("abcd______");
				checkMaskState(editor, 67, "abcd______", "abcd", "abcd");

			});

			testId = 'Check width/height';
			test(testId, 6, function () {
				var $editor1 = $('#editor1'), $editor2 = $("#editor7");

				// Default stlye from CSS
				equal($editor1.igMaskEditor("editorContainer").css("width"), "400px", "Width is not correct");
				equal($editor1.igMaskEditor("editorContainer").css("height"), "32px", "Height is not correct");

				$editor1.igMaskEditor("option", "width", 100);
				$editor1.igMaskEditor("option", "height", 100);
				equal($editor1.igMaskEditor("editorContainer").css("width"), "100px", "Width is not correct");
				equal($editor1.igMaskEditor("editorContainer").css("height"), "100px", "Height is not correct");

				// Style set from the options
				equal($editor2.igMaskEditor("editorContainer").css("width"), "300px", "Width is not correct");
				equal($editor2.igMaskEditor("editorContainer").css("height"), "70px", "Height is not correct");
			});

			var testId = 'Mask Editor Methods.';
			test(testId, 9, function () {
				var editor = $('#editor11');

				editor.igMaskEditor("field").focus();
				QUnit.stop();
				setTimeout(function () {
					QUnit.start();
					var text = editor.igMaskEditor("getSelectedText");
					equal(text, "CCC_______", "Selected text is not correct");
					var start = editor.igMaskEditor("getSelectionStart");
					var end = editor.igMaskEditor("getSelectionEnd");
					equal(start, 0, "Selection start is correct");
					equal(end, 10, "Selection start is correct");

					var btn = editor.igMaskEditor("clearButton");
					btn.click();
					checkMaskState(editor, 0, "__________", "", "");
	
					editor.igMaskEditor("field").blur();
					text = editor.igMaskEditor("getSelectedText");
					equal(text, "", "Selected text is not correct");
					
					editor.igMaskEditor("setFocus");
					stop();
					setTimeout(function () {
						QUnit.start();
						editor.igMaskEditor("insert", "abc");
						editor.igMaskEditor("select", 0, 3);
						text = editor.igMaskEditor("getSelectedText");
						start = editor.igMaskEditor("getSelectionStart");
						end = editor.igMaskEditor("getSelectionEnd");
						equal(start, 0, "Selection start is correct");
						equal(end, 3, "Selection start is correct");
					}, 100);
				}, 200);
			});
			testId = "isValid in edit mode"
			test(testId, 4, function () {
				$("#validInEditModeEditor").igMaskEditor("field").focus();
				$("#validInEditModeEditor").data("igMaskEditor")._enterEditMode();
				ok(!$("#validInEditModeEditor").igMaskEditor("isValid"), "Not all required fields are filled");
				$("#validInEditModeEditor").igMaskEditor("field").val("zz__");
				ok(!$("#validInEditModeEditor").igMaskEditor("isValid"), "Not all required fields are filled");
				$("#validInEditModeEditor").igMaskEditor("field").val("zz99");
				ok($("#validInEditModeEditor").igMaskEditor("isValid"), "All required fields are filled");
				$("#validInEditModeEditor").igMaskEditor("field").blur();
				$("#validInEditModeEditor").data("igMaskEditor")._exitEditMode();
				ok($("#validInEditModeEditor").igMaskEditor("isValid"), "All required fields are filled");
			});


			testId = 'mask editor toLower/toUpper #364';
			test(testId, 16, function () {
				//editor364_1
				var field = $("#editor364_1").igMaskEditor("field");
				$("#editor364_1").data("igMaskEditor")._enterEditMode();
				$("#editor364_1").data("igMaskEditor")._insert("nn");
				equal(field.val(), "__", "Text is not __");
				$("#editor364_1").data("igMaskEditor")._insert("12");
				equal(field.val(), "12", "Text is not __");
				$("#editor364_1").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#editor364_1').igMaskEditor("value"), "12", "Value is not 12");
				$("#editor364_1").data("igMaskEditor")._exitEditMode();
				equal($('#editor364_1').igMaskEditor("displayValue"), "12", "Value is not 12");
				//editor364_2
				field = $("#editor364_2").igMaskEditor("field");
				$("#editor364_2").data("igMaskEditor")._enterEditMode();
				$("#editor364_2").data("igMaskEditor")._insert("nn");
				equal(field.val(), "__", "Text is not __");
				$("#editor364_2").data("igMaskEditor")._insert("12");
				equal(field.val(), "12", "Text is not __");
				$("#editor364_2").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#editor364_2').igMaskEditor("value"), "12", "Value is not 12");
				$("#editor364_2").data("igMaskEditor")._exitEditMode();
				equal($('#editor364_2').igMaskEditor("displayValue"), "12", "Value is not 12");

				//editor364_3
				field = $("#editor364_3").igMaskEditor("field");
				$("#editor364_3").data("igMaskEditor")._enterEditMode();
				$("#editor364_3").data("igMaskEditor")._insert("nnnn");
				equal(field.val(), "nn____", "Text is not nn____");
				$("#editor364_3").data("igMaskEditor")._insert("nn12nn");
				equal(field.val(), "nn12nn", "Text is not 12nn");
				$("#editor364_3").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#editor364_3').igMaskEditor("value"), "nn12nn", "Value is not nn12nn");
				$("#editor364_3").data("igMaskEditor")._exitEditMode();
				equal($('#editor364_3').igMaskEditor("displayValue"), "nn12nn", "Value is not nn12nn");

				//editor364_4
				field = $("#editor364_4").igMaskEditor("field");
				$("#editor364_4").data("igMaskEditor")._enterEditMode();
				$("#editor364_4").data("igMaskEditor")._insert("nnnn");
				equal(field.val(), "NN____", "Text is not NN____");
				$("#editor364_4").data("igMaskEditor")._insert("nn12nn");
				equal(field.val(), "NN12NN", "Text is not 12nn");
				$("#editor364_4").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#editor364_4').igMaskEditor("value"), "NN12NN", "Value is not NN12NN");
				$("#editor364_4").data("igMaskEditor")._exitEditMode();
				equal($('#editor364_4').igMaskEditor("displayValue"), "NN12NN", "Value is not NN12NN");
			});
			testId = 'mask editor toLower/toUpper on paste';
			test(testId, 19, function () {
				//$("#toUpperEditor")
				var field = $("#toUpperEditor").igMaskEditor("field");
				$("#toUpperEditor").data("igMaskEditor")._enterEditMode();
				$("#toUpperEditor").data("igMaskEditor")._insert("nnAA");
				equal(field.val(), "NNAA______", "Text is not NNAA______");
				$("#toUpperEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toUpperEditor').igMaskEditor("value"), "NNAA", "Value is not NNAA");
				$("#toUpperEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toUpperEditor').igMaskEditor("displayValue"), "NNAA", "Value is not NNAA");

				field = $("#toLowerEditor").igMaskEditor("field");
				$("#toLowerEditor").data("igMaskEditor")._enterEditMode();
				$("#toLowerEditor").data("igMaskEditor")._insert("nnAA");
				equal(field.val(), "nnaa______", "Text is not nnaa______");
				$("#toLowerEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toLowerEditor').igMaskEditor("value"), "nnaa", "Value is not NNAA");
				$("#toLowerEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toLowerEditor').igMaskEditor("displayValue"), "nnaa", "Value is not NNAA");


				
				field = $("#toUppertoLowerMaskEditor").igMaskEditor("field");
				
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._enterEditMode();
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._insert("nnAAMMfRuu");
				equal(field.val(), "CNNAAmm?FrUU", "Text is not CNNAAmm?FrUU");

				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toUppertoLowerMaskEditor').igMaskEditor("value"), "CNNAAmm?FrUU", "Value is not CNNAAmm?FrU ");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toUppertoLowerMaskEditor').igMaskEditor("displayValue"), "CNNAAmm?FrUU", "displayValue is not CNNAAmm?FrUU");

				$('#toUppertoLowerMaskEditor').igMaskEditor("option", "dataMode", "rawTextWithRequiredPrompts");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._enterEditMode();
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._insert("fnAAMMfRuu");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toUppertoLowerMaskEditor').igMaskEditor("value"), "FNAAmmFrUU", "Value is not FNAAmmFrUU");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toUppertoLowerMaskEditor').igMaskEditor("displayValue"), "CFNAAmm?FrUU", "displayValue is not CFNAAmm?FrUU");


				$('#toUppertoLowerMaskEditor').igMaskEditor("option", "dataMode", "rawTextWithRequiredPromptsAndLiterals");
				$('#toUppertoLowerMaskEditor').igMaskEditor("option", "padChar", "*");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._enterEditMode();
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._insert("hnAAMMfRuu");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toUppertoLowerMaskEditor').igMaskEditor("value"), "CHNAAmm?FrUU", "Value is not HNAAmmFrU ");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toUppertoLowerMaskEditor').igMaskEditor("displayValue"), "CHNAAmm?FrUU", "displayValue is not CHNAAmm?FrUU");

				$('#toUppertoLowerMaskEditor').igMaskEditor("option", "padChar", " ");
				$('#toUppertoLowerMaskEditor').igMaskEditor("option", "dataMode", "nonExisting");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._enterEditMode();
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._insert("nnAAMMfRuu");
				equal(field.val(), "CNNAAmm?FrUU", "Text is not CNNAAmm?FrUU");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#toUppertoLowerMaskEditor').igMaskEditor("value"), "CNNAAmm?FrUU", "Value is not CNNAAmm?FrUU");
				$("#toUppertoLowerMaskEditor").data("igMaskEditor")._exitEditMode();
				equal($('#toUppertoLowerMaskEditor').igMaskEditor("displayValue"), "CNNAAmm?FrUU", "displayValue is not CNNAAmm?FrUU");
				
				//#editor233

				field = $("#editor233").igMaskEditor("field");
				$("#editor233").data("igMaskEditor")._enterEditMode();
				$("#editor233").data("igMaskEditor")._insert("asd15");
				equal(field.val(), "ASD15", "Text is not ASD15");
				$("#editor233").data("igMaskEditor")._processValueChanging(field.val());

				equal($('#editor233').igMaskEditor("value"), "ASD15", "Value is not ASD15");
				$("#editor233").data("igMaskEditor")._exitEditMode();
				equal($('#editor233').igMaskEditor("displayValue"), "ASD15", "Value is not ASD15");

			});
			testId = 'mask editor _update -> Null Value';
			test(testId, 9, function () {
				$("#customNullValueEditor").igMaskEditor("value", null);
				equal($('#customNullValueEditor').igMaskEditor("value"), "Zero", "Value is not Zero ");
				equal($("#customNullValueEditor").data("igMaskEditor")._valueInput.val(), "Zero", "Hidden Input value is not Zero ");
				equal($('#customNullValueEditor').igMaskEditor("displayValue"), "Zero", "displayValue is not Zero");
				//nullValueEditor
				$("#nullValueEditor").igMaskEditor("value", null);
				equal($('#nullValueEditor').igMaskEditor("value"), null, "Value is not null ");
				equal($("#nullValueEditor").data("igMaskEditor")._valueInput.val(), "", "Hidden Input value is not Zero ");
				equal($('#nullValueEditor').igMaskEditor("displayValue"), "", "displayValue is not Zero");
				//notNullValueEditor
				$("#notNullValueEditor").igMaskEditor("value", null);
				equal($('#notNullValueEditor').igMaskEditor("value"), "", "Value is not null ");
				equal($("#notNullValueEditor").data("igMaskEditor")._valueInput.val(), "", "Hidden Input value is not Zero ");
				equal($('#notNullValueEditor').igMaskEditor("displayValue"), "", "displayValue is not Zero");

			});
			testId = 'mask editor Coverage part 1';
			test(testId, 11, function () {
				//
				$("#pasteHandlerInput").igMaskEditor("field").focus();
				stop();
				setTimeout(function () {
					$.ig.TestUtil.paste($("#pasteHandlerInput").igMaskEditor("field")[0], "aaR15");
					setTimeout(function () {
						start();
						equal($('#pasteHandlerInput').igMaskEditor("field").val(), "aaR15", "The value is aaR15");
						$('#pasteHandlerInput').igMaskEditor("field").blur();
						$("#pasteHandlerInput").igMaskEditor("field").focus();
						$('#pasteHandlerInput').igMaskEditor("option", "revertIfNotValid", true);
						$('#pasteHandlerInput').data("igMaskEditor")._processInternalValueChanging("as;dlfkasdfl;kjasf");
						equal($('#pasteHandlerInput').igMaskEditor("field").val(), "aaR15", "The value is aaR15");
						$('#pasteHandlerInput').igMaskEditor("option", "revertIfNotValid", false);
						$("#pasteHandlerInput").igMaskEditor("field").focus();
						$('#pasteHandlerInput').data("igMaskEditor")._processInternalValueChanging("as;dlfkasdfl;kjasf");
						equal($('#pasteHandlerInput').igMaskEditor("field").val(), "__R__", "The field should empty mask with prompts");
						equal($('#pasteHandlerInput').igMaskEditor("value"), "", "The value should be empty");

						equal($('#pasteHandlerInput').data("igMaskEditor")._valueFromText("bbR23"), "bbR23", "The value is bb23");
						ok($('#pasteHandlerInput').data("igMaskEditor")._validateValueAgainstMask("zz23"), "The value zz23 is valid");
						ok(!$('#pasteHandlerInput').data("igMaskEditor")._validateValueAgainstMask("23Rsd"), "The value 23Rsd is not valid");
						ok($('#pasteHandlerInput').data("igMaskEditor")._validateValueAgainstMask(""), "The value zz23 is valid");
						ok($('#pasteHandlerInput').data("igMaskEditor")._validateValueAgainstMask("ffR23"), "The value ffdd is valid");
						ok($('#pasteHandlerInput').data("igMaskEditor")._validateRequiredPrompts(""), "The value \"\" is not valid");
						$("#pasteHandlerInput1").igMaskEditor("field").focus();
						$("#pasteHandlerInput1").data("igMaskEditor")._setCursorPosition(2);
						var evt = $.Event("keydown");
						evt.keyCode = 50;
						evt.charCode = 50;
						ok($('#pasteHandlerInput1').data("igMaskEditor")._validateKey(evt), "2 is allowed");
					}, 20);
				}, 100); 
			});

			testId = 'mask editor triggerKeyDown';
			test(testId, 9, function () {
				//keydownEditor1
				$("#keydownEditor1").igMaskEditor("field").focus().select();
				keyInteraction(8, $("#keydownEditor1").igMaskEditor("field"));
				keyInteraction(8, $("#keydownEditor1").igMaskEditor("field"));
				equal($('#keydownEditor1').igMaskEditor("field").val(), "___", "The field should empty mask with prompts");
				
				keyInteraction(86, $("#keydownEditor1").igMaskEditor("field"));
				keyInteraction(69, $("#keydownEditor1").igMaskEditor("field"));
				keyInteraction(82, $("#keydownEditor1").igMaskEditor("field"));
				equal($('#keydownEditor1').igMaskEditor("field").val(), "VER", "The field should be VER");
				$("#keydownEditor2").igMaskEditor("field").focus().select();
				keyInteraction(46, $("#keydownEditor2").igMaskEditor("field"));
				keyInteraction(46, $("#keydownEditor2").igMaskEditor("field"));
				equal($('#keydownEditor2').igMaskEditor("field").val(), "___", "The field should empty mask with prompts");
				$('#keydownEditor2').data("igMaskEditor")._setCursorPosition(0);
				keyInteraction(86, $("#keydownEditor2").igMaskEditor("field"));
				keyInteraction(69, $("#keydownEditor2").igMaskEditor("field"));
				keyInteraction(82, $("#keydownEditor2").igMaskEditor("field"));
				equal($('#keydownEditor2').igMaskEditor("field").val(), "ver", "The field should be ver");
				$("#keydownEditor3").igMaskEditor("field").focus().select();
				keyInteraction(8, $("#keydownEditor3").igMaskEditor("field"));
				equal($('#keydownEditor3').igMaskEditor("field").val(), "___", "The field should be ___");
				$('#keydownEditor2').data("igMaskEditor")._setCursorPosition(0);
				keyInteraction(86, $("#keydownEditor3").igMaskEditor("field"));
				equal($('#keydownEditor3').igMaskEditor("field").val(), "___", "The field should be ___");
				var evt = $.Event("keydown");
				evt.keyCode = 50;
				evt.charCode = 50;
				ok($('#keydownEditor3').data("igMaskEditor")._validateKey(evt), "2 is allowed");
				var ev = $.Event("keydown");
				ev.keyCode = 65;
				ev.charCode = 65;
				ok(!$('#keydownEditor3').data("igMaskEditor")._validateKey(ev), "a is not allowed allowed");
				$("#keydownEditor3").igMaskEditor("field").blur();


				ok(!$("#editor6").igMaskEditor("isValid"), "The value is not valid");
			});

			testId = "mask editor - unsupported methods and options"
			test(testId, 14, function () {
				throws(function () {
					$('#keydownEditor3').igMaskEditor("option", "excludeKeys", "abe")
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.setOptionError) > -1;
				}, $.ig.Editor.locale.setOptionError + "excludeKeys");
				throws(function () {
					$('#keydownEditor3').igMaskEditor("option", "includeKeys", "abe")
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.setOptionError) > -1;
				}, $.ig.Editor.locale.setOptionError + "includeKeys");
				//Unsupported Methods
				throws(function () {
					$('#keydownEditor3').igMaskEditor("dropDownContainer");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("showDropDown");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("hideDropDown");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("dropDownButton");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("spinUpButton");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("spinDownButton");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("dropDownVisible");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("findListItemIndex");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("selectedListIndex");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("getSelectedListItem");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("spinUp");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");

				throws(function () {
					$('#keydownEditor3').igMaskEditor("spinDown");
				}, function (err) {
					return err.message.indexOf($.ig.Editor.locale.maskEditorNoSuchMethod) > -1;
				}, $.ig.Editor.locale.maskEditorNoSuchMethod + "not shown");
			});
			testId = "unfilled Chars Prompt";
			test(testId, 6, function () {
				//unfilledCharsPromptEditor1
				//keyInteraction(key, target, special) {
				var editorInput = $("#unfilledCharsPromptEditor1").igMaskEditor("field");
				editorInput.focus().select();
				keyInteraction(48, editorInput);
				equal(editorInput.val(), "000-000-00", "The value should be 000-000-00");
				editorInput.blur();
				equal(editorInput.val(), "0--", "The value should be 0--");
				editorInput = $("#unfilledCharsPromptEditor2").igMaskEditor("field");
				equal(editorInput.val(), "450-004-03", "The value should be 450-004-03");
				equal(editorInput.igMaskEditor("value"), "450-004-03", "The value should be 450-004-03");
				$("#unfilledCharsPromptEditor2").igMaskEditor("value", "053-400-03");
				equal(editorInput.val(), "053-400-03", "The value should be 053-400-03");
				equal(editorInput.igMaskEditor("value"), "053-400-03", "The value should be 053-400-03");
			});
			testId = "Revert invalid value";
			test(testId, 8, function () {
				var editor = $("#revertEditor1");
				field = editor.igMaskEditor("field");

				editor.data("igMaskEditor")._enterEditMode();
				editor.data("igMaskEditor")._insert("1234");
				equal(field.val(), "1234", "Text is not 1234");
				editor.data("igMaskEditor")._processValueChanging(field.val());
				equal(editor.igMaskEditor("value"), "1234", "Value is not 1234");
				editor.data("igMaskEditor")._exitEditMode();
				equal(editor.igMaskEditor("displayValue"), "1234", "Value is not set");

				editor.data("igMaskEditor")._enterEditMode();
				editor.data("igMaskEditor")._insert("123_");
				equal(field.val(), "123_", "Text is not 123_");
				editor.data("igMaskEditor")._processValueChanging(field.val());
				equal(editor.igMaskEditor("value"), "1234", "Value is not 1234");
				editor.data("igMaskEditor")._exitEditMode();
				equal(editor.igMaskEditor("displayValue"), "1234", "Value is not set");

				editor = $("#revertEditor2");
				field = editor.igMaskEditor("field");

				editor.data("igMaskEditor")._enterEditMode();
				editor.data("igMaskEditor")._insert("123___");
				editor.data("igMaskEditor")._processValueChanging(field.val());
				equal(field.val(), "______", "Value is not cleared");
				editor.data("igMaskEditor")._exitEditMode();
				equal(editor.igMaskEditor("displayValue"), "", "Value is not empty");
			});


			testId = "Revert value when revertIfNotValid is set to true";
			test(testId, 3, function () {
				var editor = $("#revertEditor3"),
				field = editor.igMaskEditor("field");

				editor.data("igMaskEditor")._insert("1234");
				editor.blur();
				equal(field.val(), "1234", "Text is not 1234");
				ok($("#test").children(), "The valueChanged event was triggered.");
				$("#test span").remove();

				editor.data("igMaskEditor")._insert("123_");
				editor.blur();
				equal(field.val(), "1234", "Text is not 1234");
			});

			testId = "Revert correctly value when revertIfNotValid is set to true";
			test(testId, 2, function () {
				var $editor = $("<input/>").appendTo("#testBedContainer")
					.igMaskEditor({
						inputMask: "CCC00",
						padChar: "+",
						emptyChar: "/",
						value: "aaa"
					}),
				field = $editor.igMaskEditor("field");

				$editor.igMaskEditor("setFocus");
				$editor.data("igMaskEditor")._insert("sss__");
				$editor.blur();
				equal(field.val(), "aaa++", "Text is not reverted");
				equal($editor.igMaskEditor("value"), "aaa//", "Value is not reverted");
				$editor.remove();
			});

			testId = 'Paste and insert';
			test(testId, 16, function () {
				var $editor = $("#pasteEditor"),
					editorInput = $editor.igMaskEditor("field"),
					testPastePosition = function (val, expectedPos) {
						var defer = $.Deferred();
						$.ig.TestUtil.paste(editorInput[0], val);
						setTimeout(function () {
							equal(editorInput[0].selectionStart, expectedPos, "Cusrsor position not correct after paste");
							defer.resolve();
						}, 20);
						return defer;
					};
				
				editorInput.trigger("focus");
				stop();
				setTimeout(function () {	
					testPastePosition("57", 2).then(function( value ) {
						//57|-__/__(test)
						equal(editorInput.val(), "57-__/__(test)", "The text after paste is not correct");
						return testPastePosition("2ab", 7);
					}).then(function( value ) {
						//57-2a/B|_(test)
						equal(editorInput.val(), "57-2a/B_(test)", "The text after paste is not correct");
						return testPastePosition("c", 8);
					}).then(function( value ) {
						//57-2a/BC(test)|
						equal(editorInput.val(), "57-2a/BC(test)", "The text after paste is not correct");
						//verify paste doesn't go beyond the mask
						return testPastePosition("random", 14);
					}).then(function( value ) {
						equal(editorInput.val(), "57-2a/BC(test)", "The text after paste is not correct");
						editorInput[0].select();
						keyInteraction(8, editorInput);
						return testPastePosition("57-2a", 5);
					}).then(function( value ) {
						//57-2a|/__(test)
						editorInput[0].select();
						equal(editorInput.val(), "57-2a/__(test)", "The text after paste is not correct");
						return testPastePosition("572a/bc", 8);
					}).then(function( value ) {
						//57-2a/BC|(test)
						equal(editorInput.val(), "57-2a/BC(test)", "The text after paste is not correct");
						editorInput[0].select();
						return testPastePosition("572abc(test)", 14);
					}).then(function( value ) {
						//57-2a/BC(test)|
						equal(editorInput.val(), "57-2a/BC(test)", "The text after paste is not correct");
						editorInput[0].select();
						return testPastePosition("572abc(more random string value test)", 14);
					}).then(function( value ) {
						//57-2a/BC(test)|
						equal(editorInput.val(), "57-2a/BC(test)", "The text after paste is not correct");
						start();
					});
				}, 200);
			});


			testing = "Clear button dynamic show/hide";
			test(testing, 5, function() {
				var field = $("#clearButton_439").igMaskEditor("field"),
				clearButton = $("#clearButton_439").igMaskEditor("clearButton");
				ok(!clearButton.is(":visible"), "The clear button should not be visible initilly");
				field.focus();
				ok(!clearButton.is(":visible"), "The clear button should not be visible on focus");
				field.val("someVal");
				
				$("#clearButton_439").data("igMaskEditor")._processTextChanged();
				ok(clearButton.is(":visible"), "The clear button should be visible");
				field.blur();
				equal(field.val(), "someVal", "The value should be SomeVal");
				ok(clearButton.is(":visible"), "The clear button should be visible on blur");
			});
			testId = 'Drag and drop';
			test(testId, 13, function () {
				var $editor = $("#pasteEditor"),
					editorInput = $editor.igMaskEditor("field"),
					testDropPosition = function (val, expectedPos) {
						var defer = $.Deferred();
						
						editorInput[0].selectionStart = expectedPos[0];
						$.ig.TestUtil.drop(editorInput[0], val);
						setTimeout(function () {
							equal(editorInput[0].selectionStart, expectedPos[0], "Selection start not correct after drop");
							equal(editorInput[0].selectionEnd, expectedPos[1], "Selection end not correct after drop");
							defer.resolve();
						}, 20);
						return defer;
					};
				editorInput.blur();
				$editor.igMaskEditor("value", "");

				// drag enter/leave events:
				editorInput.trigger("dragenter");
				equal(editorInput.val(), "__-__/__(test)", "Editor didn't enter edit mode on dragenter");
				// fake FF interaction:
				$.ig.util.isFF = true;
				var ev = jQuery.Event( "dragleave" );
				ev.relatedTarget = editorInput[0];
				editorInput.trigger(ev);
				equal(editorInput.val(), "__-__/__(test)", "Editor exited edit mode on inner dragleave");
				$.ig.util.isFF = false;

				editorInput.trigger("dragleave");
				equal(editorInput.val(), "", "Editor didn't exit edit mode on dragenter");

				// drop text with focus
				editorInput.trigger("dragenter");
				equal(editorInput.val(), "__-__/__(test)", "Editor didn't enter edit mode on dragenter");
				stop();
				testDropPosition("57", [0,2])
				.then(function( value ) {
					//|57|-__/__(test)
					equal(editorInput.val(), "57-__/__(test)", "The text after drop is not correct");
					return testDropPosition("2ab", [2, 7]);
				}).then(function( value ) {
					//57-|2a/B|_(test)
					equal(editorInput.val(), "57-2a/B_(test)", "The text after drop is not correct");
					return testDropPosition("cc", [7, 14]);
				}).then(function( value ) {
					//57-2a/B|C(test)|
					equal(editorInput.val(), "57-2a/BC(test)", "The text after drop is not correct");
					start();
				});
			});
			testId = "Test nullValue on initialization";
			test(testId, 9, function(){
				var $editor = $("<input id='editor'/>").
				appendTo("#testBedContainer").igMaskEditor({ allowNullValue: false});
				//Get null Value
				equal($editor.igMaskEditor("value"), "", "The value is not an empty string");
				//Set null Value
				$editor.igMaskEditor("value", null);
				equal($editor.igMaskEditor("value"), "", "The value is not an empty string");
				//CHange allowNullValue option
				$editor.igMaskEditor("option", "allowNullValue", true);
				// Get Null value
				equal($editor.igMaskEditor("value"), "", "The value is not an empty string");
				//Set Null value
				$editor.igMaskEditor("value", null);
				//Get null value
				equal($editor.igMaskEditor("value"), null, "The value is not an empty string");
				$editor.remove();

				// test invalid nullValue
				$editor = $("<input />").appendTo("#testBedContainer")
					.igMaskEditor({ 
						inputMask: "9990",
						dataMode: "rawText",
						nullValue: "abc",
						allowNullValue: true,
						buttonType: "clear"
					});

				equal($editor.val(), "", "Display did not initialize correctly");
				strictEqual($editor.igMaskEditor("value"), "", "Null value should be ignored on init");
				//check clear also ignores the wrong nullValue:
				$editor.igMaskEditor("value", "555");
				$editor.igMaskEditor("clearButton").trigger("click");
				strictEqual($editor.igMaskEditor("value"), "", "Null value should be ignored on clear");
				$editor.igMaskEditor("value", "123");
				$editor.igMaskEditor("value", null);
				strictEqual($editor.igMaskEditor("value"), "", "Null value should be ignored on set");
				//verify empty string is still accepted
				$editor.igMaskEditor("value", "");
				strictEqual($editor.igMaskEditor("value"), "", "Empty value should be accepted");
				$editor.remove();
			});

			testId = 'Clear button state';
			test(testId, 2, function () {
				var $editor;

				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ buttonType: "clear" });
				ok(!$editor.igMaskEditor("clearButton").is(":visible"), "Clear button is not hidden");
				$editor.igMaskEditor("value", "someVal");
				ok($editor.igMaskEditor("clearButton").is(":visible"), "Clear button is not visible");
				$editor.remove();
			});

			var testId = 'Paste value in editor with escaped flags';
			test(testId, 3, function () {
				var $editor;
				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ inputMask: "\\00-0000-0000" });
				var field = $editor.igMaskEditor("field");
				$editor.data("igMaskEditor")._enterEditMode();
				$editor.data("igMaskEditor")._insert("11111111111");
				equal(field.val(), "01-1111-1111", "Text is not 01-1111-1111");
				$editor.remove();
				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ inputMask: "00-\\0000-0000" });
				var field = $editor.igMaskEditor("field");
				$editor.data("igMaskEditor")._enterEditMode();
				$editor.data("igMaskEditor")._insert("11111111111");
				equal(field.val(), "11-0111-1111", "Text is not 11-0111-1111");
				$editor.remove();
				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ inputMask: "LL-LLLL-LL\\LL" });
				var field = $editor.igMaskEditor("field");
				$editor.data("igMaskEditor")._enterEditMode();
				$editor.data("igMaskEditor")._insert("MMMMMMMMMMMM");
				equal(field.val(), "MM-MMMM-MMLM", "Text is not MM-MMMM-MMLM");
				$editor.remove();
			});

			testId = "Test with special characters";
			QUnit.test(testId, function (assert) {
				assert.expect(14);
				var $editor;
				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ inputMask: "LLLLL" });
				var field = $editor.igMaskEditor("field");
				function enterValue(value){
					$editor.focus()[0].setSelectionRange(0,0);
					$.ig.TestUtil.type(value, field);
				}
				var testValues = [{
					value: "たかむごひ",
					valid: true
				},{
					value: "ⰁⰂⰃⰄⰅ",
					valid: true
				},{
					value: "ퟻퟺퟯퟮퟭ",
					valid: true
				},{
					value: "₩₩₩₩₩",
					valid: false,
					expected: "_____"
				},{
					value: "Ⰰ⯿⯾⯽⯼",
					valid: false,
					expected: "Ⰰ____"
				},{
					value: "‐‑‒–—",
					valid: false,
					expected: "_____"
				},{
					value: "¿¾½¼»",
					valid: false,
					expected: "_____"
				}]
				for(var i=0; i< testValues.length; i++){
					$editor.igMaskEditor("field").val("_____");
					enterValue(testValues[i].value);
					assert.ok($editor.igMaskEditor("isValid") == testValues[i].valid, "Value is expected to be accepted.");
					assert.equal(field.val(), testValues[i].valid ? testValues[i].value : testValues[i].expected, "The text is not as expected");
				}
			});

			testId = "Should properly revert to last valid value";
			QUnit.test(testId, function (assert) {
				assert.expect(3);
				var $editor;
				$editor = $('<input/>').appendTo("#testBedContainer").igMaskEditor({ 
					inputMask: "(000) 000-000",
					dataMode: "rawText"
				});
				var field = $editor.igMaskEditor("field");
				$editor.focus()[0].setSelectionRange(0,0);
				$.ig.TestUtil.type("111111111", field);
				$editor.blur();
				$editor.focus()[0].setSelectionRange(12, 13);
				$editor.val("(111) 111-11_");
				$editor.blur();
				$editor.focus()[0].setSelectionRange(12,13);
				debugger;
				$.ig.TestUtil.type("2222", field);
				$editor.blur();
				assert.equal($editor.data("igMaskEditor")._maskedValue.length, 13, "The editor value should be the appropriate length");
				assert.ok($editor.data("igMaskEditor")._editorInput.val().indexOf("(") > -1,"The displayed value has the mask in place");
				assert.equal($editor.igMaskEditor("value"), "111111112", "The editor value should be reverted to the last valid one");
			});
		});

		function checkMaskState(editor, keyCode, editValue, displayValue, value) {
			keyInteraction(65, editor);
			equal(editor.igMaskEditor("field").val(), editValue, "Edit value is incorrect");
			editor.igMaskEditor("field").blur();
			equal(editor.igMaskEditor("displayValue"), displayValue, "Display value is incorrect");
			equal(editor.igMaskEditor("value"), value, "Value that needs to be sent to the server is incorrect");
		}

		function fireKeyEvent(target, type, keyCode) {
			var evt = document.createEvent('KeyboardEvent');

			// Chromium Hack
			Object.defineProperty(evt, 'keyCode', {
				get: function () {
					return this.keyCodeVal;
				}
			});
			Object.defineProperty(evt, 'which', {
				get: function () {
					return this.keyCodeVal;
				}
			});
			//Object.defineProperty(evt, 'charCode', {
			//	get: function () {
			//		return String.fromCharCode(this.keyCodeVal);
			//	}
			//});

			if (evt.initKeyboardEvent) {
				evt.initKeyboardEvent(type, true, true, document.defaultView, false, false, false, false, keyCode, keyCode);
			} else {
				evt.initKeyEvent(type, true, true, document.defaultView, false, false, false, false, keyCode, 0);
			}

			evt.keyCodeVal = keyCode;

			if (evt.keyCode !== keyCode) {
				alert("keyCode mismatch " + evt.keyCode + "(" + evt.which + ")");
			}

			target.dispatchEvent(evt);
		}
		function keyInteraction(key, target, special) {
			keyDownChar(key, target, special);
			keyPressChar(key, target, special);
			keyUpChar(key, target, special);
		}
		function keyDownChar(key, target, special) {
			var evt = $.Event("keydown");
			evt.keyCode = key;
			evt.charCode = key;
			if (special) {
				evt[special] = true;
			}
			target.trigger(evt);
		}
		function keyPressChar(key, target, special) {
			var evt = $.Event("keypress");
			evt.keyCode = key;
			evt.charCode = key;
			if (special) {
				evt[special] = true;
			}
			target.trigger(evt);
		}
		function keyUpChar(key, target, special) {
			var evt = $.Event("keyup");
			evt.keyCode = key;
			evt.charCode = key;
			if (special) {
				evt[special] = true;
			}
			target.trigger(evt);
		}
		function mouseInteraction(type, element) {
			// create a mouse click event
			var event = document.createEvent('MouseEvents');
			event.initMouseEvent(type, true, true, window, 1, 0, 0);
			if (type === "mousemove") {
				event.pageX = 100;
				event.pageY = 100;
			}
			// send click to element
			element.dispatchEvent(event);

		}
		function mouseup(element) {
			// create a mouse click event
			var event = document.createEvent('MouseEvents');
			event.initMouseEvent('mouseup', true, true, window, 1, 0, 0, null, null, false, false, false, false, 0, null);

			// send click to element
			element.dispatchEvent(event);
		}
		function mousedown(element) {
			// create a mouse click event
			var event = document.createEvent('MouseEvents');
			event.initMouseEvent('mousedown', true, true, window, 1, 0, 0, null, null, false, false, false, false, 0, null);

			// send click to element
			element.dispatchEvent(event);
		}
	</script>

</head>
<body>
<div style="float:right;width:400px;overflow:auto">
	 <h1 id="qunit-header">Test results</h1>
	 <h2 id="qunit-banner"></h2>
	 <h2 id="qunit-userAgent"></h2>
	 <ol id="qunit-tests"></ol>
</div>
	<div id="testBedContainer" style="float:left;overflow:auto;padding:20px;position:absolute;width:500px; height:100%">
		
		<div id="maskEditorRuntime"></div>
		<input type="text" id="editor1" />
		<input type="text" id="editor11" />
		<div type="text" id="editor2"></div>
		<div type="text" id="editor3" ></div>
		<input type="text" id="editor4" />
		<span type="text" id="editor5" ></span>
		<input type="text" id="editor6" />
		<div id="editor7" type="text" name="disabledEditor" tabindex="1" disabled=disabled disabled=disabled readonly=readonly value="disabled"></div>


		<form id="registerSubmit" method="post">
			<span>Div Editor Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C<br /> allText</span>
			<br />
			<div id="divEditor">
			</div>
			<br />
			<span>Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C <br /> rawText</span>
			<br />
			<div id="rawTextEditor"></div>
			<br />
			<br />
			<span>Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C <br /> rawTextWithRequiredPrompts</span>
			<br />
			<div id="rawTextWithRequiredPromptsEditor"></div>
			<br />

			<br />
			<span>Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C <br /> rawTextWithAllPrompts</span>
			<br />
			<div id="rawTextWithAllPromptsEditor"></div>
			<br />

			<br />
			<span>Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C <br /> rawTextWithLiterals</span>
			<br />
			<div id="rawTextWithLiteralsEditor"></div>
			<br />
			<br />
			<span>Mask: NMK\\AOIU\\CY0TGFC9\\A&:C\\A\\L\\a\\9C <br /> rawTextWithRequiredPromptsAndLiterals</span>
			<br />
			<div id="rawTextWithRequiredPromptsAndLiteralsEditor"></div>
			<br />
			<input type="button" value="GetValues" id="getValues" />

			<br />
			<span>Values:</span>
			<br />
			<div id="valuesContainer"></div>
			<br />
			<br />
			<br />
			<br />
			<input type="text" id="toLowerEditor" />
			<input type="text" id="toUpperEditor" />
			<input type="text" id="toUppertoLowerMaskEditor" />

			<br />
			<br />
			<input type="text" id="nullValueEditor" />
			<input type="text" id="customNullValueEditor" />
			<input type="text" id="notNullValueEditor" />
			<!--
		<input id="readonlyManipulator" type="checkbox" value="ReadOnly" /><label>ReadOnly</label>
		<input id="disabledManipulator" type="checkbox" value="Disabled" /><label>disabled</label>-->
			<input type="text" id="validInEditModeEditor" />
			<input type="text" id="pasteHandlerInput"/>
			<input type="text" id="pasteHandlerInput1" />
			<input type="text" id="pasteEditor" />
			<input type="text" id="keydownEditor1" />
			<input type="text" id="keydownEditor2" />
			<input type="text" id="keydownEditor3" />
			<input type="text" id="unfilledCharsPromptEditor1" />
			<input type="text" id="unfilledCharsPromptEditor2" />
			<input type="text" id="revertEditor1" />
			<input type="text" id="revertEditor2" />
			<input type="text" id="revertEditor3" />
			<input type="text" id="editor233"/>
			<input type="text" id="editor364_1" />
			<input type="text" id="editor364_2" />
			<input type="text" id="editor364_3" />
			<input type="text" id="editor364_4" />
			<input type="text" id="maskEditorRequired" />
			<div id="test"></div>
				<input id="clearButton_439"/>			
		<input type='submit' value="Submit" />

		</form>
	</div>
</body>
</html>

